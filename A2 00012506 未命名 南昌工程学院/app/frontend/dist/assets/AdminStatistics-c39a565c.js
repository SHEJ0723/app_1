import{b as M,c as Z,a as F}from"./statistics-39f7298b.js";import{C as P}from"./CommonButton-70b7e8fe.js";import{_ as G,r as l,w as U,s as J,k as $,b,o as w,c as C,d as t,e as i,f as k,t as a,h as u,B as q,F as H,J as K,E as x,N as O,C as Q}from"./index-06309a7e.js";import"./index-d5848531.js";const W={class:"fade-in"},X={class:"mb-6 flex justify-between items-center"},Y={class:"flex items-center gap-3"},z={class:"text-xs text-gray-500"},tt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},st={class:"stat-card"},et={class:"flex justify-between items-start"},at={class:"text-2xl font-semibold mt-1"},lt={class:"text-success text-sm mt-2 flex items-center"},ot={class:"stat-card"},nt={class:"flex justify-between items-start"},it={class:"text-2xl font-semibold mt-1"},rt={class:"text-success text-sm mt-2 flex items-center"},ct={class:"stat-card"},dt={class:"flex justify-between items-start"},ut={class:"text-2xl font-semibold mt-1"},mt={class:"stat-card"},ft={class:"flex justify-between items-start"},pt={class:"text-2xl font-semibold mt-1"},vt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},xt={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-5"},gt={class:"flex justify-between items-center mb-6"},yt={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},_t={class:"flex justify-between items-center p-5 border-b border-gray-100"},ht={class:"overflow-x-auto"},bt={class:"w-full"},wt={class:"divide-y divide-gray-200"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},kt={class:"px-6 py-4 whitespace-nowrap text-sm"},St={class:"px-6 py-4 whitespace-nowrap text-sm"},jt={class:"px-6 py-4 whitespace-nowrap text-sm"},Rt={class:"flex items-center"},At={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},Bt={class:"text-xs text-gray-500"},It={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600"},Vt={class:"px-6 py-4 whitespace-nowrap"},Et={__name:"AdminStatistics",setup(Tt){const v=l("30"),S=l(0),j=l(0),R=l(0),A=l(0),B=l(0),I=l(0);l(!1);const g=l(!1),r=l(!0),c=l(null),y=l(null);let m=null,f=null;const _=l([]),L=async()=>{try{const e=await M();e.success?(_.value=e.data,console.log("分区统计数据加载成功:",_.value)):console.error("分区统计数据加载失败:",e.message)}catch(e){console.error("获取分区统计失败:",e)}},N=async()=>{try{const e=await Z();if(e.success){const s=e.data;S.value=s.monthly_income||0,j.value=s.monthly_traffic||0,R.value=s.avg_parking_time||2.1,A.value=s.occupancy_rate||78,B.value=s.income_growth||0,I.value=s.traffic_growth||0,console.log("月度统计数据加载成功:",s)}else console.error("月度统计数据加载失败:",e.message)}catch(e){console.error("获取月度统计失败:",e)}},V=async()=>{try{const e=await F(parseInt(v.value));if(e.success){const s=e.data;m&&m.destroy();const p=document.getElementById("incomeChart");p&&(m=new Chart(p,{type:"line",data:{labels:s.income_trend.map(o=>o.date),datasets:[{label:"收入",data:s.income_trend.map(o=>o.income),borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(o){return"¥"+o}}}}}})),f&&f.destroy();const d=document.getElementById("trafficChart");d&&(f=new Chart(d,{type:"bar",data:{labels:s.traffic_trend.map(o=>o.date),datasets:[{label:"车流量",data:s.traffic_trend.map(o=>o.traffic),backgroundColor:"#10B981",borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})),console.log("图表数据更新成功")}else console.error("图表数据更新失败:",e.message)}catch(e){console.error("更新图表失败:",e)}},h=async()=>{g.value=!0;try{await Promise.all([N(),L(),V()]),y.value=Date.now(),x.success("数据刷新成功")}catch(e){console.error("手动刷新失败:",e),x.error("数据刷新失败")}finally{g.value=!1}},D=()=>{r.value=!r.value,r.value?(E(),x.success("自动刷新已开启")):(T(),x.info("自动刷新已关闭"))},E=()=>{c.value&&clearInterval(c.value),c.value=setInterval(()=>{h()},5*60*1e3)},T=()=>{c.value&&(clearInterval(c.value),c.value=null)};return U(v,()=>{V()}),J(async()=>{await h(),r.value&&E()}),$(()=>{T(),m&&m.destroy(),f&&f.destroy()}),(e,s)=>{const p=b("el-button"),d=b("el-option"),o=b("el-select");return w(),C("div",W,[t("div",X,[s[2]||(s[2]=t("div",null,[t("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"数据统计"),t("p",{class:"text-gray-500 mt-1"},"停车场运营数据分析和统计")],-1)),t("div",Y,[i(p,{onClick:h,loading:g.value,type:"primary",size:"small",icon:"Refresh"},{default:k(()=>s[1]||(s[1]=[u(" 手动刷新 ")])),_:1,__:[1]},8,["loading"]),i(p,{onClick:D,type:r.value?"success":"info",size:"small"},{default:k(()=>[u(a(r.value?"自动刷新开启":"自动刷新关闭"),1)]),_:1},8,["type"]),t("div",z,a(y.value?`最后更新: ${new Date(y.value).toLocaleTimeString()}`:"未更新"),1)])]),t("div",tt,[t("div",st,[t("div",et,[t("div",null,[s[5]||(s[5]=t("p",{class:"text-gray-500 text-sm"},"本月收入",-1)),t("h3",at,"¥"+a(S.value.toLocaleString()),1),t("p",lt,[s[3]||(s[3]=t("i",{class:"fa fa-arrow-up mr-1"},null,-1)),u(" "+a(B.value)+"% ",1),s[4]||(s[4]=t("span",{class:"text-gray-500 ml-1"},"较上月",-1))])]),s[6]||(s[6]=t("div",{class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary"},[t("i",{class:"fa fa-money"})],-1))])]),t("div",ot,[t("div",nt,[t("div",null,[s[9]||(s[9]=t("p",{class:"text-gray-500 text-sm"},"本月车流量",-1)),t("h3",it,a(j.value.toLocaleString()),1),t("p",rt,[s[7]||(s[7]=t("i",{class:"fa fa-arrow-up mr-1"},null,-1)),u(" "+a(I.value)+"% ",1),s[8]||(s[8]=t("span",{class:"text-gray-500 ml-1"},"较上月",-1))])]),s[10]||(s[10]=t("div",{class:"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center text-success"},[t("i",{class:"fa fa-car"})],-1))])]),t("div",ct,[t("div",dt,[t("div",null,[s[11]||(s[11]=t("p",{class:"text-gray-500 text-sm"},"平均停车时长",-1)),t("h3",ut,a(R.value)+"小时",1),s[12]||(s[12]=t("p",{class:"text-warning text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-clock-o mr-1"}),u(" 2.1小时 "),t("span",{class:"text-gray-500 ml-1"},"平均")],-1))]),s[13]||(s[13]=t("div",{class:"w-10 h-10 rounded-full bg-warning/10 flex items-center justify-center text-warning"},[t("i",{class:"fa fa-clock-o"})],-1))])]),t("div",mt,[t("div",ft,[t("div",null,[s[14]||(s[14]=t("p",{class:"text-gray-500 text-sm"},"车位使用率",-1)),t("h3",pt,a(A.value)+"%",1),s[15]||(s[15]=t("p",{class:"text-info text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-chart-pie mr-1"}),u(" 高峰期 "),t("span",{class:"text-gray-500 ml-1"},"85%")],-1))]),s[16]||(s[16]=t("div",{class:"w-10 h-10 rounded-full bg-info/10 flex items-center justify-center text-info"},[t("i",{class:"fa fa-chart-pie"})],-1))])])]),t("div",vt,[t("div",xt,[t("div",gt,[s[17]||(s[17]=t("h3",{class:"font-medium"},"收入趋势",-1)),i(o,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=n=>v.value=n),placeholder:"选择时间范围",size:"small"},{default:k(()=>[i(d,{label:"近7天",value:"7"}),i(d,{label:"近30天",value:"30"}),i(d,{label:"近90天",value:"90"})]),_:1},8,["modelValue"])]),s[18]||(s[18]=t("div",{class:"h-80"},[t("canvas",{id:"incomeChart"})],-1))]),s[19]||(s[19]=q('<div class="bg-white rounded-lg shadow-sm border border-gray-100 p-5" data-v-0e463802><div class="flex justify-between items-center mb-6" data-v-0e463802><h3 class="font-medium" data-v-0e463802>车流量分布</h3><button class="text-gray-400 hover:text-primary" data-v-0e463802><i class="fa fa-ellipsis-v" data-v-0e463802></i></button></div><div class="h-80 flex items-center justify-center" data-v-0e463802><canvas id="trafficChart" data-v-0e463802></canvas></div></div>',1))]),t("div",yt,[t("div",_t,[s[20]||(s[20]=t("h3",{class:"font-medium"},"分区统计详情",-1)),i(P,{type:"text",size:"small",text:"导出报表"})]),t("div",ht,[t("table",bt,[s[21]||(s[21]=t("thead",null,[t("tr",{class:"bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[t("th",{class:"px-6 py-3"},"分区"),t("th",{class:"px-6 py-3"},"总车位"),t("th",{class:"px-6 py-3"},"已占用"),t("th",{class:"px-6 py-3"},"使用率"),t("th",{class:"px-6 py-3"},"今日收入"),t("th",{class:"px-6 py-3"},"状态")])],-1)),t("tbody",wt,[(w(!0),C(H,null,K(_.value,n=>(w(),C("tr",{key:n.name,class:"table-row-hover"},[t("td",Ct,a(n.name),1),t("td",kt,a(n.total),1),t("td",St,a(n.occupied),1),t("td",jt,[t("div",Rt,[t("div",At,[t("div",{class:"bg-primary h-2 rounded-full",style:O({width:n.usage+"%"})},null,4)]),t("span",Bt,a(n.usage)+"%",1)])]),t("td",It,"¥"+a(n.income),1),t("td",Vt,[t("span",{class:Q([n.status==="正常"?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs rounded-full"])},a(n.status),3)])]))),128))])])])])])}}},Zt=G(Et,[["__scopeId","data-v-0e463802"]]);export{Zt as default};
