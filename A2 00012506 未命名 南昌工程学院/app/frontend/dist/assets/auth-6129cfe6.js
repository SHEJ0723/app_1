import{m as h,n as l,p as m}from"./index-06309a7e.js";const s=h.create({baseURL:"http://localhost:5000",timeout:1e4,withCredentials:!0,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{const r=l();return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));s.interceptors.response.use(e=>e.data,e=>{var o,t,n,a,c,i,p;if(console.error("API Error:",e),((o=e.response)==null?void 0:o.status)===401)return m(),window.location.pathname!=="/login"&&(window.location.href="/login"),Promise.reject(new Error(((t=e.response.data)==null?void 0:t.message)||"登录已过期，请重新登录"));if(((n=e.response)==null?void 0:n.status)===400){const u=((a=e.response.data)==null?void 0:a.message)||"请求参数错误";return Promise.reject(new Error(u))}if(((c=e.response)==null?void 0:c.status)===404)return Promise.reject(new Error("请求的资源不存在"));const r=((p=(i=e.response)==null?void 0:i.data)==null?void 0:p.message)||"请求失败";return Promise.reject(new Error(r))});const g={async getCaptcha(){try{return await s.get("/api/captcha")}catch(e){throw console.error("获取验证码失败:",e),e}},async userLogin(e){try{return await s.post("/api/user-login",e)}catch(r){throw console.error("用户登录失败:",r),r}},async adminLogin(e){try{return await s.post("/api/admin-login",e)}catch(r){throw console.error("管理员登录失败:",r),r}},async register(e){try{return await s.post("/api/register",e)}catch(r){throw console.error("用户注册失败:",r),r}},logout(){return localStorage.removeItem("token"),localStorage.removeItem("userInfo"),localStorage.removeItem("userType"),Promise.resolve()},async sendCaptchaCode(e,r="reset"){try{return await s.post("/api/send-captcha",{phone:e,purpose:r})}catch(o){throw console.error("生成图片验证码失败:",o),o}},async resetPassword(e){try{return await s.post("/api/reset-password",e)}catch(r){throw console.error("重置密码失败:",r),r}}};export{g as a};
