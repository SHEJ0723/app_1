import{_ as U,u as E,r as u,a as S,k as $,b as c,o as _,c as y,d,e as o,f as l,i as q,l as B,h as v,t as R,E as r}from"./index-06309a7e.js";import{a as C}from"./auth-6129cfe6.js";const A={class:"login-bg"},N={class:"captcha-image-container"},D=["src"],L={class:"login-link"},M={__name:"ForgotPassword",setup(T){const V=E(),g=u(null),f=u(!1),w=u(""),p=u(0),m=u(null),a=S({phone:"",captchaCode:"",newPassword:"",confirmPassword:""}),k={phone:[{required:!0,message:"请输入手机号",trigger:"change"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"change"}],captchaCode:[{required:!0,message:"请输入验证码",trigger:"change"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,validator:(t,e,s)=>{e===""?s(new Error("请再次输入密码")):e!==a.newPassword?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}]},P=async()=>{var t;try{if(!a.phone){r.warning("请先输入手机号");return}if(!/^1[3-9]\d{9}$/.test(a.phone)){r.error("请输入正确的手机号格式");return}const e=await C.sendCaptchaCode(a.phone,"reset");e.success?(r.success(e.message||"验证码已生成"),w.value=e.data.image,e.data.text&&localStorage.setItem("temp_captcha",e.data.text),p.value=60,m.value=setInterval(()=>{p.value--,p.value<=0&&clearInterval(m.value)},1e3)):r.error(e.message||"生成失败")}catch(e){if(console.error("生成验证码失败:",e),(t=e.response)!=null&&t.data){const s=e.response.data;s.phone&&Array.isArray(s.phone)?r.error(s.phone[0]||"手机号格式错误"):s.message?r.error(s.message):r.error("生成验证码失败")}else r.error(e.message||"生成验证码失败")}},x=()=>{a.phone?P():r.warning("请先输入手机号")},b=async()=>{if(g.value)try{await g.value.validate();const t=localStorage.getItem("temp_captcha");if(t&&a.captchaCode.toUpperCase()!==t){r.error("验证码错误");return}f.value=!0;const e=await C.resetPassword({phone:a.phone,smsCode:a.captchaCode,newPassword:a.newPassword});e.success?(r.success(e.message||"密码重置成功，请使用新密码登录"),localStorage.removeItem("temp_captcha"),V.push("/login")):r.error(e.message||"密码重置失败")}catch(t){console.error("重置密码失败:",t),r.error(t.message||"重置密码失败")}finally{f.value=!1}};return $(()=>{m.value&&clearInterval(m.value)}),(t,e)=>{const s=c("el-input"),i=c("el-form-item"),h=c("el-button"),I=c("el-form"),F=c("el-card");return _(),y("div",A,[e[9]||(e[9]=d("div",{class:"bg-shape bg-shape-1"},null,-1)),e[10]||(e[10]=d("div",{class:"bg-shape bg-shape-2"},null,-1)),e[11]||(e[11]=d("div",{class:"bg-shape bg-shape-3"},null,-1)),o(F,{class:"forgot-password-card"},{default:l(()=>[e[7]||(e[7]=d("h2",null,"重置密码",-1)),e[8]||(e[8]=d("p",{class:"subtitle"},"请输入您的手机号,我们将发送验证码帮您重置密码",-1)),o(I,{ref_key:"forgotPasswordFormRef",ref:g,model:a,rules:k,"label-width":"80px",class:"forgot-password-form",onSubmit:q(b,["prevent"])},{default:l(()=>[o(i,{label:"* 手机号",prop:"phone"},{default:l(()=>[o(s,{modelValue:a.phone,"onUpdate:modelValue":e[0]||(e[0]=n=>a.phone=n),placeholder:"请输入手机号","prefix-icon":"Phone",clearable:""},null,8,["modelValue"])]),_:1}),o(i,{label:"* 验证码",prop:"captchaCode"},{default:l(()=>[o(s,{modelValue:a.captchaCode,"onUpdate:modelValue":e[1]||(e[1]=n=>a.captchaCode=n),placeholder:"请输入图片验证码","prefix-icon":"Picture",clearable:""},null,8,["modelValue"]),d("div",N,[w.value?(_(),y("img",{key:0,src:w.value,onClick:x,class:"captcha-image",alt:"验证码"},null,8,D)):(_(),B(h,{key:1,type:"primary",onClick:P,disabled:p.value>0,style:{width:"100%"}},{default:l(()=>[v(R(p.value>0?`${p.value}s`:"获取验证码"),1)]),_:1},8,["disabled"]))])]),_:1}),o(i,{label:"* 新密码",prop:"newPassword"},{default:l(()=>[o(s,{modelValue:a.newPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>a.newPassword=n),type:"password",placeholder:"请输入新密码","prefix-icon":"Lock","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),o(i,{label:"* 确认密码",prop:"confirmPassword"},{default:l(()=>[o(s,{modelValue:a.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>a.confirmPassword=n),type:"password",placeholder:"请再次输入新密码","prefix-icon":"Lock","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),o(i,null,{default:l(()=>[o(h,{type:"primary",onClick:b,loading:f.value,style:{width:"100%"}},{default:l(()=>e[5]||(e[5]=[v(" 重置密码 ")])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["model"]),d("div",L,[o(h,{link:"",type:"primary",onClick:e[4]||(e[4]=n=>t.$router.push("/login"))},{default:l(()=>e[6]||(e[6]=[v(" 想起密码了?立即登录 ")])),_:1,__:[6]})])]),_:1,__:[7,8]})])}}},H=U(M,[["__scopeId","data-v-15d5fd95"]]);export{H as default};
