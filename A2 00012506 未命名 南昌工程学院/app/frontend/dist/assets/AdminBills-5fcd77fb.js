import{g as ie,a as ue,e as me,b as pe,u as ce,c as fe,d as ve,s as ge}from"./bills-b83bd519.js";import{_ as _e,r as m,a as ye,s as be,b as _,I as xe,o as x,c as B,d as l,t as n,e as t,f as o,D as we,l as q,E as d,h as y,j,L as J}from"./index-06309a7e.js";import"./index-d5848531.js";const Ve=()=>{console.log("=== 调试认证状态 ===");const R=localStorage.getItem("token");if(console.log("Token:",R?"存在":"不存在"),R)try{const f=JSON.parse(atob(R.split(".")[1]));console.log("Token payload:",f),console.log("Token 过期时间:",new Date(f.exp*1e3)),console.log("Token 是否过期:",f.exp*1e3<Date.now())}catch(f){console.log("Token 解析失败:",f)}const S=localStorage.getItem("userInfo");console.log("用户信息:",S?JSON.parse(S):"不存在");const U=localStorage.getItem("userType");console.log("用户类型:",U),console.log("=== 调试完成 ===")};const ke={class:"fade-in"},Be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},Ce={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4"},Se={class:"flex items-center justify-between"},he={class:"text-2xl font-bold text-gray-900"},He={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4"},ze={class:"flex items-center justify-between"},Ue={class:"text-2xl font-bold text-green-600"},De={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4"},Ie={class:"flex items-center justify-between"},Re={class:"text-2xl font-bold text-orange-600"},je={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4"},Te={class:"flex items-center justify-between"},Le={class:"text-2xl font-bold text-blue-600"},Ae={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-5 mb-6"},Me={class:"flex flex-wrap gap-4 items-center"},Ne={class:"flex items-center gap-2"},Ye={class:"flex items-center gap-2"},$e={class:"flex items-center gap-2"},Ee={class:"flex items-center gap-2"},Fe={class:"flex gap-2"},Pe={class:"flex justify-between items-center mb-6"},Oe={class:"flex gap-2"},qe={class:"text-sm text-gray-500"},Je={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},Ge={class:"font-medium"},Ke={class:"font-medium text-green-600"},Qe={key:0},We={key:1,class:"text-gray-400"},Xe={key:0},Ze={key:1,class:"text-gray-400"},el={class:"flex gap-1"},ll={class:"px-6 py-4 border-t border-gray-100 flex justify-between items-center"},tl={class:"text-sm text-gray-500"},sl={key:0,class:"space-y-4"},al={class:"grid grid-cols-2 gap-4"},ol={class:"text-sm"},nl={class:"text-sm"},dl={class:"text-sm"},rl={class:"text-sm"},il={class:"text-sm"},ul={class:"text-sm font-medium text-green-600"},ml={class:"text-sm"},pl={class:"text-sm"},cl={class:"text-sm"},fl={key:0},vl={class:"text-sm"},gl={key:1},_l={class:"text-sm"},yl={__name:"AdminBills",setup(R){const S=m([]),U=m(!1),f=m(0),C=m(1),h=m(10),T=m(!1),i=m(null),D=m(!1),v=m({}),I=m(!1),p=m({}),L=m(!1),A=m(!1),M=m(!1),H=m({}),r=ye({status:"",user_name:"",order_id:"",dateRange:[]}),V=async()=>{U.value=!0;try{const a={page:C.value,per_page:h.value,status:r.status,user_name:r.user_name,order_id:r.order_id};r.dateRange&&r.dateRange.length===2&&(a.start_date=r.dateRange[0],a.end_date=r.dateRange[1]),console.log("loadBillsHandler - 请求参数:",a);const e=await ie(a);console.log("loadBillsHandler - 完整API响应:",e),e.success?(S.value=e.data,f.value=e.total,console.log("loadBillsHandler - 账单数据:",S.value),console.log("loadBillsHandler - 总数:",f.value)):(console.error("loadBillsHandler - API返回失败:",e.message),d.error(e.message||"获取账单列表失败"))}catch(a){console.error("获取账单列表失败:",a),d.error("获取账单列表失败")}finally{U.value=!1}},N=async()=>{try{console.log("loadStatisticsHandler - 开始获取统计信息");const a=await ue();console.log("loadStatisticsHandler - 完整API响应:",a),a.success?(H.value=a.data,console.log("loadStatisticsHandler - 统计数据:",H.value)):console.error("loadStatisticsHandler - API返回失败:",a.message)}catch(a){console.error("获取统计信息失败:",a)}},G=()=>{r.status="",r.user_name="",r.order_id="",r.dateRange=[],C.value=1,V()},K=a=>{h.value=a,V()},Q=a=>{C.value=a,V()},E=a=>({已支付:"success",未支付:"warning",已取消:"danger"})[a]||"info",z=a=>a?new Date(a).toLocaleString("zh-CN"):"",W=async a=>{try{const e=await pe(a.id);e.success?(i.value=e.data,T.value=!0):d.error(e.message||"获取账单详情失败")}catch(e){console.error("获取账单详情失败:",e),d.error("获取账单详情失败")}},X=a=>{v.value={id:a.id,amount:a.amount,status:a.status,pay_method:a.pay_method,pay_time:a.pay_time},D.value=!0},Z=async()=>{L.value=!0;try{const a=await ce(v.value.id,v.value);a.success?(d.success("账单更新成功"),D.value=!1,V()):d.error(a.message||"更新失败")}catch(a){console.error("更新账单失败:",a),d.error("更新账单失败")}finally{L.value=!1}},ee=()=>{p.value={user_id:"",order_id:"",amount:"",status:"未支付",pay_method:""},I.value=!0},le=async()=>{A.value=!0;try{const a=await fe(p.value);a.success?(d.success("账单创建成功"),I.value=!1,V(),N()):d.error(a.message||"创建失败")}catch(a){console.error("创建账单失败:",a),d.error("创建账单失败")}finally{A.value=!1}},te=async a=>{try{await J.confirm(`确定要删除账单 BILL-${String(a.id).padStart(6,"0")} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await ve(a.id);e.success?(d.success("账单删除成功"),V(),N()):d.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除账单失败:",e),d.error("删除账单失败"))}},se=async a=>{try{await J.confirm(`确定要向用户 ${a.user_name} 发送支付提醒吗？`,"发送提醒",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await ge(a.id);e.success?d.success("提醒发送成功"):d.error(e.message||"发送失败")}catch(e){e!=="cancel"&&(console.error("发送提醒失败:",e),d.error("发送提醒失败"))}},ae=async()=>{M.value=!0;try{const a=await me();if(a.success){const e=JSON.stringify(a.data,null,2),u=new Blob([e],{type:"application/json"}),k=URL.createObjectURL(u),g=document.createElement("a");g.href=k,g.download=a.filename,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(k),d.success("账单导出成功")}else d.error(a.message||"导出失败")}catch(a){console.error("导出账单失败:",a),d.error("导出账单失败")}finally{M.value=!1}},oe=()=>{d.info("报表生成功能开发中...")};return be(()=>{Ve(),V(),N()}),(a,e)=>{const u=_("el-option"),k=_("el-select"),g=_("el-input"),F=_("el-date-picker"),c=_("el-button"),b=_("el-table-column"),P=_("el-tag"),ne=_("el-table"),de=_("el-pagination"),Y=_("el-dialog"),w=_("el-form-item"),O=_("el-form"),re=xe("loading");return x(),B("div",ke,[e[57]||(e[57]=l("div",{class:"mb-6"},[l("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"账单管理"),l("p",{class:"text-gray-500 mt-1"},"管理用户账单和支付记录")],-1)),l("div",Be,[l("div",Ce,[l("div",Se,[l("div",null,[e[20]||(e[20]=l("p",{class:"text-sm text-gray-500"},"总账单数",-1)),l("p",he,n(H.value.total_bills||0),1)]),e[21]||(e[21]=l("div",{class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[l("i",{class:"fa fa-file-text text-blue-600"})],-1))])]),l("div",He,[l("div",ze,[l("div",null,[e[22]||(e[22]=l("p",{class:"text-sm text-gray-500"},"已支付",-1)),l("p",Ue,n(H.value.paid_bills||0),1)]),e[23]||(e[23]=l("div",{class:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center"},[l("i",{class:"fa fa-check text-green-600"})],-1))])]),l("div",De,[l("div",Ie,[l("div",null,[e[24]||(e[24]=l("p",{class:"text-sm text-gray-500"},"未支付",-1)),l("p",Re,n(H.value.unpaid_bills||0),1)]),e[25]||(e[25]=l("div",{class:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center"},[l("i",{class:"fa fa-clock text-orange-600"})],-1))])]),l("div",je,[l("div",Te,[l("div",null,[e[26]||(e[26]=l("p",{class:"text-sm text-gray-500"},"总金额",-1)),l("p",Le,"¥"+n((H.value.total_amount||0).toFixed(2)),1)]),e[27]||(e[27]=l("div",{class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[l("i",{class:"fa fa-yen text-blue-600"})],-1))])])]),l("div",Ae,[l("div",Me,[l("div",Ne,[e[28]||(e[28]=l("label",{class:"text-sm font-medium text-gray-700"},"状态:",-1)),t(k,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=s=>r.status=s),placeholder:"选择状态",clearable:"",size:"small",style:{width:"120px"}},{default:o(()=>[t(u,{label:"已支付",value:"已支付"}),t(u,{label:"未支付",value:"未支付"}),t(u,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),l("div",Ye,[e[29]||(e[29]=l("label",{class:"text-sm font-medium text-gray-700"},"用户名:",-1)),t(g,{modelValue:r.user_name,"onUpdate:modelValue":e[1]||(e[1]=s=>r.user_name=s),placeholder:"搜索用户名",size:"small",style:{width:"150px"}},null,8,["modelValue"])]),l("div",$e,[e[30]||(e[30]=l("label",{class:"text-sm font-medium text-gray-700"},"订单号:",-1)),t(g,{modelValue:r.order_id,"onUpdate:modelValue":e[2]||(e[2]=s=>r.order_id=s),placeholder:"搜索订单号",size:"small",style:{width:"150px"}},null,8,["modelValue"])]),l("div",Ee,[e[31]||(e[31]=l("label",{class:"text-sm font-medium text-gray-700"},"时间范围:",-1)),t(F,{modelValue:r.dateRange,"onUpdate:modelValue":e[3]||(e[3]=s=>r.dateRange=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",style:{width:"240px"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),l("div",Fe,[t(c,{type:"primary",size:"small",onClick:V},{default:o(()=>e[32]||(e[32]=[l("i",{class:"fa fa-search mr-1"},null,-1),y("搜索 ")])),_:1,__:[32]}),t(c,{size:"small",onClick:G},{default:o(()=>e[33]||(e[33]=[l("i",{class:"fa fa-refresh mr-1"},null,-1),y("重置 ")])),_:1,__:[33]})])])]),l("div",Pe,[l("div",Oe,[t(c,{onClick:ae,loading:M.value},{default:o(()=>e[34]||(e[34]=[l("i",{class:"fa fa-download mr-1"},null,-1),y("导出账单 ")])),_:1,__:[34]},8,["loading"]),t(c,{onClick:oe},{default:o(()=>e[35]||(e[35]=[l("i",{class:"fa fa-chart-bar mr-1"},null,-1),y("生成报表 ")])),_:1,__:[35]}),t(c,{type:"primary",onClick:ee},{default:o(()=>e[36]||(e[36]=[l("i",{class:"fa fa-plus mr-1"},null,-1),y("新增账单 ")])),_:1,__:[36]})]),l("div",qe," 共 "+n(f.value)+" 条账单记录 ",1)]),l("div",Je,[we((x(),q(ne,{data:S.value,class:"table-row-hover"},{default:o(()=>[t(b,{prop:"id",label:"账单编号",width:"120"},{default:o(({row:s})=>[l("span",Ge,"BILL-"+n(String(s.id).padStart(6,"0")),1)]),_:1}),t(b,{prop:"user_name",label:"用户名",width:"120"}),t(b,{prop:"user_phone",label:"用户电话",width:"130"}),t(b,{prop:"order_number",label:"订单编号",width:"120"}),t(b,{prop:"amount",label:"金额",width:"100"},{default:o(({row:s})=>[l("span",Ke,"¥"+n(s.amount.toFixed(2)),1)]),_:1}),t(b,{prop:"status",label:"状态",width:"100"},{default:o(({row:s})=>[t(P,{type:E(s.status),size:"small"},{default:o(()=>[y(n(s.status),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"pay_method",label:"支付方式",width:"100"},{default:o(({row:s})=>[s.pay_method?(x(),B("span",Qe,n(s.pay_method),1)):(x(),B("span",We,"未支付"))]),_:1}),t(b,{prop:"created_at",label:"创建时间",width:"160"},{default:o(({row:s})=>[y(n(z(s.created_at)),1)]),_:1}),t(b,{prop:"pay_time",label:"支付时间",width:"160"},{default:o(({row:s})=>[s.pay_time?(x(),B("span",Xe,n(z(s.pay_time)),1)):(x(),B("span",Ze,"未支付"))]),_:1}),t(b,{label:"操作",width:"180",fixed:"right"},{default:o(({row:s})=>[l("div",el,[t(c,{size:"small",onClick:$=>W(s)},{default:o(()=>e[37]||(e[37]=[l("i",{class:"fa fa-eye"},null,-1)])),_:2,__:[37]},1032,["onClick"]),t(c,{size:"small",type:"primary",onClick:$=>X(s)},{default:o(()=>e[38]||(e[38]=[l("i",{class:"fa fa-edit"},null,-1)])),_:2,__:[38]},1032,["onClick"]),s.status==="未支付"?(x(),q(c,{key:0,size:"small",type:"warning",onClick:$=>se(s)},{default:o(()=>e[39]||(e[39]=[l("i",{class:"fa fa-bell"},null,-1)])),_:2,__:[39]},1032,["onClick"])):j("",!0),t(c,{size:"small",type:"danger",onClick:$=>te(s)},{default:o(()=>e[40]||(e[40]=[l("i",{class:"fa fa-trash"},null,-1)])),_:2,__:[40]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[re,U.value]]),l("div",ll,[l("p",tl,"显示 "+n((C.value-1)*h.value+1)+" 至 "+n(Math.min(C.value*h.value,f.value))+" 条，共 "+n(f.value)+" 条",1),t(de,{"current-page":C.value,"onUpdate:currentPage":e[4]||(e[4]=s=>C.value=s),"page-size":h.value,"onUpdate:pageSize":e[5]||(e[5]=s=>h.value=s),"page-sizes":[10,20,50,100],layout:"sizes, prev, pager, next",total:f.value,onSizeChange:K,onCurrentChange:Q,size:"small"},null,8,["current-page","page-size","total"])])]),t(Y,{modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=s=>T.value=s),title:"账单详情",width:"700px"},{default:o(()=>[i.value?(x(),B("div",sl,[l("div",al,[l("div",null,[e[41]||(e[41]=l("label",{class:"text-sm font-medium text-gray-700"},"账单编号:",-1)),l("p",ol,"BILL-"+n(String(i.value.id).padStart(6,"0")),1)]),l("div",null,[e[42]||(e[42]=l("label",{class:"text-sm font-medium text-gray-700"},"订单编号:",-1)),l("p",nl,n(i.value.order_number),1)]),l("div",null,[e[43]||(e[43]=l("label",{class:"text-sm font-medium text-gray-700"},"用户名:",-1)),l("p",dl,n(i.value.user_name),1)]),l("div",null,[e[44]||(e[44]=l("label",{class:"text-sm font-medium text-gray-700"},"用户电话:",-1)),l("p",rl,n(i.value.user_phone),1)]),l("div",null,[e[45]||(e[45]=l("label",{class:"text-sm font-medium text-gray-700"},"用户邮箱:",-1)),l("p",il,n(i.value.user_email||"未设置"),1)]),l("div",null,[e[46]||(e[46]=l("label",{class:"text-sm font-medium text-gray-700"},"金额:",-1)),l("p",ul,"¥"+n(i.value.amount.toFixed(2)),1)]),l("div",null,[e[47]||(e[47]=l("label",{class:"text-sm font-medium text-gray-700"},"状态:",-1)),t(P,{type:E(i.value.status),size:"small"},{default:o(()=>[y(n(i.value.status),1)]),_:1},8,["type"])]),l("div",null,[e[48]||(e[48]=l("label",{class:"text-sm font-medium text-gray-700"},"支付方式:",-1)),l("p",ml,n(i.value.pay_method||"未支付"),1)]),l("div",null,[e[49]||(e[49]=l("label",{class:"text-sm font-medium text-gray-700"},"创建时间:",-1)),l("p",pl,n(z(i.value.created_at)),1)]),l("div",null,[e[50]||(e[50]=l("label",{class:"text-sm font-medium text-gray-700"},"支付时间:",-1)),l("p",cl,n(i.value.pay_time?z(i.value.pay_time):"未支付"),1)]),i.value.order_start_time?(x(),B("div",fl,[e[51]||(e[51]=l("label",{class:"text-sm font-medium text-gray-700"},"订单开始时间:",-1)),l("p",vl,n(z(i.value.order_start_time)),1)])):j("",!0),i.value.order_end_time?(x(),B("div",gl,[e[52]||(e[52]=l("label",{class:"text-sm font-medium text-gray-700"},"订单结束时间:",-1)),l("p",_l,n(z(i.value.order_end_time)),1)])):j("",!0)])])):j("",!0)]),_:1},8,["modelValue"]),t(Y,{modelValue:D.value,"onUpdate:modelValue":e[12]||(e[12]=s=>D.value=s),title:"编辑账单",width:"500px"},{footer:o(()=>[t(c,{onClick:e[11]||(e[11]=s=>D.value=!1)},{default:o(()=>e[53]||(e[53]=[y("取消")])),_:1,__:[53]}),t(c,{type:"primary",onClick:Z,loading:L.value},{default:o(()=>e[54]||(e[54]=[y("保存")])),_:1,__:[54]},8,["loading"])]),default:o(()=>[t(O,{model:v.value,"label-width":"100px"},{default:o(()=>[t(w,{label:"金额"},{default:o(()=>[t(g,{modelValue:v.value.amount,"onUpdate:modelValue":e[7]||(e[7]=s=>v.value.amount=s),type:"number",step:"0.01"},null,8,["modelValue"])]),_:1}),t(w,{label:"状态"},{default:o(()=>[t(k,{modelValue:v.value.status,"onUpdate:modelValue":e[8]||(e[8]=s=>v.value.status=s)},{default:o(()=>[t(u,{label:"已支付",value:"已支付"}),t(u,{label:"未支付",value:"未支付"}),t(u,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"支付方式"},{default:o(()=>[t(k,{modelValue:v.value.pay_method,"onUpdate:modelValue":e[9]||(e[9]=s=>v.value.pay_method=s),clearable:""},{default:o(()=>[t(u,{label:"支付宝",value:"支付宝"}),t(u,{label:"微信",value:"微信"}),t(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"支付时间"},{default:o(()=>[t(F,{modelValue:v.value.pay_time,"onUpdate:modelValue":e[10]||(e[10]=s=>v.value.pay_time=s),type:"datetime",placeholder:"选择支付时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(Y,{modelValue:I.value,"onUpdate:modelValue":e[19]||(e[19]=s=>I.value=s),title:"新增账单",width:"500px"},{footer:o(()=>[t(c,{onClick:e[18]||(e[18]=s=>I.value=!1)},{default:o(()=>e[55]||(e[55]=[y("取消")])),_:1,__:[55]}),t(c,{type:"primary",onClick:le,loading:A.value},{default:o(()=>e[56]||(e[56]=[y("创建")])),_:1,__:[56]},8,["loading"])]),default:o(()=>[t(O,{model:p.value,"label-width":"100px"},{default:o(()=>[t(w,{label:"用户ID",required:""},{default:o(()=>[t(g,{modelValue:p.value.user_id,"onUpdate:modelValue":e[13]||(e[13]=s=>p.value.user_id=s),type:"number"},null,8,["modelValue"])]),_:1}),t(w,{label:"订单ID",required:""},{default:o(()=>[t(g,{modelValue:p.value.order_id,"onUpdate:modelValue":e[14]||(e[14]=s=>p.value.order_id=s),type:"number"},null,8,["modelValue"])]),_:1}),t(w,{label:"金额",required:""},{default:o(()=>[t(g,{modelValue:p.value.amount,"onUpdate:modelValue":e[15]||(e[15]=s=>p.value.amount=s),type:"number",step:"0.01"},null,8,["modelValue"])]),_:1}),t(w,{label:"状态"},{default:o(()=>[t(k,{modelValue:p.value.status,"onUpdate:modelValue":e[16]||(e[16]=s=>p.value.status=s)},{default:o(()=>[t(u,{label:"已支付",value:"已支付"}),t(u,{label:"未支付",value:"未支付"}),t(u,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"支付方式"},{default:o(()=>[t(k,{modelValue:p.value.pay_method,"onUpdate:modelValue":e[17]||(e[17]=s=>p.value.pay_method=s),clearable:""},{default:o(()=>[t(u,{label:"支付宝",value:"支付宝"}),t(u,{label:"微信",value:"微信"}),t(u,{label:"银行卡",value:"银行卡"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Vl=_e(yl,[["__scopeId","data-v-90986a8f"]]);export{Vl as default};
