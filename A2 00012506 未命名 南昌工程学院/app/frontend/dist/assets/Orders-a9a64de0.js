import{g as $,p as z,a as M}from"./orders-5a34db32.js";import{_ as E,r as b,H as y,s as N,b as h,o as n,c as p,d as t,e as w,f as d,t as l,F as V,J as F,j as c,E as u,h as r,C as T,l as m,L as D}from"./index-06309a7e.js";import"./index-d5848531.js";const I={class:"fade-in"},L={class:"mb-6"},S={class:"flex justify-between items-center"},A={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},H={class:"stat-card"},J={class:"flex justify-between items-start"},q={class:"text-2xl font-semibold mt-1"},G={class:"stat-card"},K={class:"flex justify-between items-start"},P={class:"text-2xl font-semibold mt-1"},Q={class:"stat-card"},R={class:"flex justify-between items-start"},U={class:"text-2xl font-semibold mt-1"},W={class:"stat-card"},X={class:"flex justify-between items-start"},Y={class:"text-2xl font-semibold mt-1"},Z={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-6"},tt={class:"flex justify-between items-center mb-6"},st={class:"overflow-x-auto"},et={class:"w-full"},at={class:"py-3 px-4 text-sm font-medium"},lt={class:"py-3 px-4 text-sm"},nt={class:"py-3 px-4 text-sm"},it={class:"py-3 px-4 text-sm"},ot={class:"py-3 px-4 text-sm font-medium"},dt={class:"py-3 px-4"},rt={class:"py-3 px-4 text-sm"},ct={class:"py-3 px-4"},ut={class:"flex gap-2"},mt={key:0,class:"text-center py-12"},ft={__name:"Orders",setup(xt){const i=b([]),f=b(!1),k=y(()=>i.value.filter(a=>a.status==="已完成").length),C=y(()=>i.value.filter(a=>a.status==="未支付").length),j=y(()=>i.value.reduce((a,s)=>a+(s.amount||0),0).toFixed(2)),O=a=>({已完成:"bg-success/10 text-success",进行中:"bg-warning/10 text-warning",已取消:"bg-gray-100 text-gray-600",未支付:"bg-danger/10 text-danger"})[a]||"bg-gray-100 text-gray-600",x=async()=>{f.value=!0;try{const a=await $();i.value=a.data||[]}catch(a){u.error(a.message||"获取订单失败")}finally{f.value=!1}},g=async(a,s)=>{try{await z(a.id,s),u.success("支付成功"),x()}catch(o){u.error(o.message||"支付失败")}},B=async a=>{try{await D.confirm(`确定要取消订单 ${a.id} 的预约吗？
取消后车位将重新变为可用状态。`,"确认取消预约",{confirmButtonText:"确定取消",cancelButtonText:"取消",type:"warning"}),await M(a.id),u.success("预约已取消，车位已释放"),x()}catch(s){s!=="cancel"&&u.error(s.message||"取消预约失败")}};return N(x),(a,s)=>{const o=h("el-button"),_=h("el-tag");return n(),p("div",I,[t("div",L,[t("div",S,[s[2]||(s[2]=t("div",null,[t("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"我的订单"),t("p",{class:"text-gray-500 mt-1"},"查看和管理您的停车订单")],-1)),w(o,{type:"primary",onClick:s[0]||(s[0]=e=>a.$router.push("/user")),class:"back-btn"},{default:d(()=>s[1]||(s[1]=[t("i",{class:"fa fa-arrow-left mr-2"},null,-1),r(" 返回首页 ")])),_:1,__:[1]})])]),t("div",A,[t("div",H,[t("div",J,[t("div",null,[s[3]||(s[3]=t("p",{class:"text-gray-500 text-sm"},"总订单数",-1)),t("h3",q,l(i.value.length),1)]),s[4]||(s[4]=t("div",{class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary"},[t("i",{class:"fa fa-list"})],-1))])]),t("div",G,[t("div",K,[t("div",null,[s[5]||(s[5]=t("p",{class:"text-gray-500 text-sm"},"已完成",-1)),t("h3",P,l(k.value),1)]),s[6]||(s[6]=t("div",{class:"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center text-success"},[t("i",{class:"fa fa-check"})],-1))])]),t("div",Q,[t("div",R,[t("div",null,[s[7]||(s[7]=t("p",{class:"text-gray-500 text-sm"},"待支付",-1)),t("h3",U,l(C.value),1)]),s[8]||(s[8]=t("div",{class:"w-10 h-10 rounded-full bg-warning/10 flex items-center justify-center text-warning"},[t("i",{class:"fa fa-clock-o"})],-1))])]),t("div",W,[t("div",X,[t("div",null,[s[9]||(s[9]=t("p",{class:"text-gray-500 text-sm"},"总金额",-1)),t("h3",Y,"¥"+l(j.value),1)]),s[10]||(s[10]=t("div",{class:"w-10 h-10 rounded-full bg-info/10 flex items-center justify-center text-info"},[t("i",{class:"fa fa-money"})],-1))])])]),t("div",Z,[t("div",tt,[s[12]||(s[12]=t("h3",{class:"font-medium text-lg"},"订单列表",-1)),w(o,{type:"primary",size:"small",onClick:x,loading:f.value},{default:d(()=>s[11]||(s[11]=[t("i",{class:"fa fa-refresh mr-1"},null,-1),r(" 刷新 ")])),_:1,__:[11]},8,["loading"])]),t("div",st,[t("table",et,[s[18]||(s[18]=t("thead",null,[t("tr",{class:"border-b border-gray-100"},[t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"订单号"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"车位ID"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"开始时间"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"结束时间"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"金额"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"状态"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"支付方式"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"操作")])],-1)),t("tbody",null,[(n(!0),p(V,null,F(i.value,e=>(n(),p("tr",{key:e.id,class:"border-b border-gray-50 hover:bg-gray-50"},[t("td",at,l(e.id),1),t("td",lt,l(e.spot_id),1),t("td",nt,l(e.start_time),1),t("td",it,l(e.end_time),1),t("td",ot,"¥"+l(e.amount),1),t("td",dt,[t("span",{class:T([O(e.status),"px-2 py-1 rounded-full text-xs"])},l(e.status),3)]),t("td",rt,l(e.pay_method||"-"),1),t("td",ct,[t("div",ut,[e.status==="未支付"?(n(),m(o,{key:0,type:"primary",size:"small",onClick:v=>g(e,"支付宝"),class:"pay-btn"},{default:d(()=>s[13]||(s[13]=[t("i",{class:"fa fa-credit-card mr-1"},null,-1),r(" 支付宝 ")])),_:2,__:[13]},1032,["onClick"])):c("",!0),e.status==="未支付"?(n(),m(o,{key:1,type:"success",size:"small",onClick:v=>g(e,"微信"),class:"pay-btn"},{default:d(()=>s[14]||(s[14]=[t("i",{class:"fa fa-wechat mr-1"},null,-1),r(" 微信 ")])),_:2,__:[14]},1032,["onClick"])):c("",!0),e.status==="未支付"||e.status==="进行中"?(n(),m(o,{key:2,type:"danger",size:"small",onClick:v=>B(e),class:"cancel-btn"},{default:d(()=>s[15]||(s[15]=[t("i",{class:"fa fa-times mr-1"},null,-1),r(" 取消预约 ")])),_:2,__:[15]},1032,["onClick"])):c("",!0),e.status==="已完成"?(n(),m(_,{key:3,type:"success",class:"paid-tag"},{default:d(()=>s[16]||(s[16]=[t("i",{class:"fa fa-check mr-1"},null,-1),r(" 已支付 ")])),_:1,__:[16]})):c("",!0),e.status==="已取消"?(n(),m(_,{key:4,type:"danger",class:"cancelled-tag"},{default:d(()=>s[17]||(s[17]=[t("i",{class:"fa fa-times mr-1"},null,-1),r(" 已取消 ")])),_:1,__:[17]})):c("",!0)])])]))),128))])])]),i.value.length===0&&!f.value?(n(),p("div",mt,s[19]||(s[19]=[t("i",{class:"fa fa-inbox text-4xl text-gray-300 mb-4"},null,-1),t("p",{class:"text-gray-500"},"暂无订单记录",-1)]))):c("",!0)])])}}},_t=E(ft,[["__scopeId","data-v-334970ae"]]);export{_t as default};
