import{_ as T}from"./bujutu-9805eb74.js";import{g as z,a as L}from"./statistics-39f7298b.js";import{C as N}from"./CommonButton-70b7e8fe.js";import{_ as U,r as a,w as M,s as G,k as Z,b as h,o as $,c as q,d as t,e as n,f as w,t as c,h as u,B as H,E as f}from"./index-06309a7e.js";import"./index-d5848531.js";const J={class:"fade-in"},K={class:"mb-6 flex justify-between items-center"},O={class:"flex items-center gap-3"},P={class:"text-xs text-gray-500"},Q={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"},W={class:"stat-card"},X={class:"flex justify-between items-start"},Y={class:"text-2xl font-semibold mt-1"},tt={class:"stat-card"},st={class:"flex justify-between items-start"},et={class:"text-2xl font-semibold mt-1"},at={class:"stat-card"},lt={class:"flex justify-between items-start"},ot={class:"text-2xl font-semibold mt-1"},it={class:"stat-card"},nt={class:"flex justify-between items-start"},rt={class:"text-2xl font-semibold mt-1"},dt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},ct={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-5 lg:col-span-2"},ut={class:"flex justify-between items-center mb-6"},ft={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},mt={class:"flex justify-between items-center p-5 border-b border-gray-100"},vt={__name:"AdminDashboard",setup(pt){const C=a(0),j=a(0),k=a(0),D=a("--"),g=a("30"),A=a(!1),b=a(!1),r=a(!0),d=a(null),y=a(null),_=async()=>{A.value=!0;try{const e=await z();e.success&&e.data&&(C.value=e.data.income||0,j.value=e.data.traffic||0,k.value=e.data.available_spots||0,D.value=e.data.peak_time||"--",R(e.data),y.value=new Date,f.success("数据已更新"))}catch(e){f.error("获取统计数据失败"),console.error("获取统计数据失败",e)}finally{A.value=!1}},B=async()=>{b.value=!0;try{await _(),await x(),f.success("数据已手动刷新")}catch{f.error("刷新失败")}finally{b.value=!1}},R=e=>{},E=()=>{d.value&&clearInterval(d.value),d.value=setInterval(async()=>{r.value&&(await _(),await x())},30*60*1e3)},S=()=>{d.value&&(clearInterval(d.value),d.value=null)},I=()=>{r.value=!r.value,r.value?f.success("自动刷新已开启"):f.info("自动刷新已关闭")};let m=null,v=null;const x=async()=>{try{const e=await L(parseInt(g.value));e.success&&e.data&&(V(e.data.traffic_trend),F(e.data.usage_distribution))}catch(e){console.error("更新图表失败",e)}},V=e=>{const s=document.getElementById("trafficChart");if(!s)return;m&&m.destroy();const o=e.map(l=>l.date),i=e.map(l=>l.traffic);m=new Chart(s.getContext("2d"),{type:"line",data:{labels:o,datasets:[{label:"车流量",data:i,borderColor:"#165DFF",backgroundColor:"rgba(22, 93, 255, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(l){return l.toLocaleString()}}}}}})},F=e=>{const s=document.getElementById("usageChart");if(!s)return;v&&v.destroy();const o=e.map(p=>p.status),i=e.map(p=>p.count),l=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7"];v=new Chart(s.getContext("2d"),{type:"doughnut",data:{labels:o,datasets:[{data:i,backgroundColor:l.slice(0,o.length)}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})};return M(g,()=>{x()}),G(async()=>{await _(),await x(),E()}),Z(()=>{S(),m&&m.destroy(),v&&v.destroy()}),(e,s)=>{const o=h("el-button"),i=h("el-option"),l=h("el-select");return $(),q("div",J,[t("div",K,[s[2]||(s[2]=t("div",null,[t("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"仪表盘"),t("p",{class:"text-gray-500 mt-1"},"欢迎回来，这里是停车场系统概览")],-1)),t("div",O,[n(o,{onClick:B,loading:b.value,type:"primary",size:"small",icon:"Refresh"},{default:w(()=>s[1]||(s[1]=[u(" 手动刷新 ")])),_:1,__:[1]},8,["loading"]),n(o,{onClick:I,type:r.value?"success":"info",size:"small"},{default:w(()=>[u(c(r.value?"自动刷新开启":"自动刷新关闭"),1)]),_:1},8,["type"]),t("div",P,c(y.value?`最后更新: ${new Date(y.value).toLocaleTimeString()}`:"未更新"),1)])]),t("div",Q,[t("div",W,[t("div",X,[t("div",null,[s[3]||(s[3]=t("p",{class:"text-gray-500 text-sm"},"今日收入",-1)),t("h3",Y,"¥"+c(C.value.toLocaleString()),1),s[4]||(s[4]=t("p",{class:"text-success text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-arrow-up mr-1"}),u(" 12.5% "),t("span",{class:"text-gray-500 ml-1"},"较昨日")],-1))]),s[5]||(s[5]=t("div",{class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary"},[t("i",{class:"fa fa-money"})],-1))])]),t("div",tt,[t("div",st,[t("div",null,[s[6]||(s[6]=t("p",{class:"text-gray-500 text-sm"},"今日车流量",-1)),t("h3",et,c(j.value),1),s[7]||(s[7]=t("p",{class:"text-success text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-arrow-up mr-1"}),u(" 8.2% "),t("span",{class:"text-gray-500 ml-1"},"较昨日")],-1))]),s[8]||(s[8]=t("div",{class:"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center text-success"},[t("i",{class:"fa fa-car"})],-1))])]),t("div",at,[t("div",lt,[t("div",null,[s[9]||(s[9]=t("p",{class:"text-gray-500 text-sm"},"空闲车位",-1)),t("h3",ot,c(k.value),1),s[10]||(s[10]=t("p",{class:"text-success text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-arrow-up mr-1"}),u(" 5.3% "),t("span",{class:"text-gray-500 ml-1"},"较上周")],-1))]),s[11]||(s[11]=t("div",{class:"w-10 h-10 rounded-full bg-warning/10 flex items-center justify-center text-warning"},[t("i",{class:"fa fa-car"})],-1))])]),t("div",it,[t("div",nt,[t("div",null,[s[12]||(s[12]=t("p",{class:"text-gray-500 text-sm"},"高峰时段",-1)),t("h3",rt,c(D.value),1),s[13]||(s[13]=t("p",{class:"text-danger text-sm mt-2 flex items-center"},[t("i",{class:"fa fa-clock-o mr-1"}),u(" 当前时段 "),t("span",{class:"text-gray-500 ml-1"},"繁忙")],-1))]),s[14]||(s[14]=t("div",{class:"w-10 h-10 rounded-full bg-danger/10 flex items-center justify-center text-danger"},[t("i",{class:"fa fa-clock-o"})],-1))])])]),t("div",dt,[t("div",ct,[t("div",ut,[s[15]||(s[15]=t("h3",{class:"font-medium"},"车流量趋势",-1)),n(l,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=p=>g.value=p),placeholder:"选择时间范围",size:"small"},{default:w(()=>[n(i,{label:"近7天",value:"7"}),n(i,{label:"近30天",value:"30"}),n(i,{label:"近90天",value:"90"})]),_:1},8,["modelValue"])]),s[16]||(s[16]=t("div",{class:"h-80"},[t("canvas",{id:"trafficChart"})],-1))]),s[17]||(s[17]=H('<div class="bg-white rounded-lg shadow-sm border border-gray-100 p-5" data-v-40ce6721><div class="flex justify-between items-center mb-6" data-v-40ce6721><h3 class="font-medium" data-v-40ce6721>车位使用率</h3><button class="text-gray-400 hover:text-primary" data-v-40ce6721><i class="fa fa-ellipsis-v" data-v-40ce6721></i></button></div><div class="h-80 flex items-center justify-center" data-v-40ce6721><canvas id="usageChart" data-v-40ce6721></canvas></div></div>',1))]),t("div",ft,[t("div",mt,[s[18]||(s[18]=t("h3",{class:"font-medium"},"停车场布局图",-1)),n(N,{type:"text",size:"small",text:"查看详情"})]),s[19]||(s[19]=t("div",{class:"p-5"},[t("img",{src:T,alt:"停车场布局图",class:"max-w-full rounded-lg shadow-sm border border-gray-200"})],-1))])])}}},ht=U(vt,[["__scopeId","data-v-40ce6721"]]);export{ht as default};
