import{_ as R,r as p,u as j,s as q,b as a,o as w,c as C,d as n,e as t,f as l,h as o,F as G,J as H,l as K,t as U,E as f}from"./index-06309a7e.js";import{g as P}from"./users-b6f22b71.js";import{a as M}from"./index-d5848531.js";const Q={class:"admin-messages-container"},W={style:{"margin-bottom":"24px","text-align":"center"}},X={style:{display:"flex","align-items":"center",gap:"12px",width:"100%"}},Y={style:{margin:"32px auto 0 auto","max-width":"900px"}},Z={style:{"margin-bottom":"12px"}},ee={style:{"text-align":"center","margin-top":"32px"}},te={__name:"AdminMessages",setup(le){const r=p([]),m=p(""),c=p([]),y=j(),_=p(!1),v=p(null),u=p(""),S=async()=>{const i=await P({page:1,pageSize:1e3});c.value=Array.isArray(i)?i:i.list||[]},A=()=>{r.value=c.value.map(i=>i.id)},D=async()=>{if(!r.value.length||!m.value){f.error("请选择用户并输入内容");return}await M.post("/api/messages/send",{receiver_ids:r.value,content:m.value}),f.success("发送成功"),m.value="",r.value=[]},B=i=>{v.value=i,u.value="",_.value=!0},I=async()=>{if(!u.value){f.error("请输入消息内容");return}await M.post("/api/messages/send",{receiver_ids:[v.value.id],content:u.value}),f.success("发送成功"),_.value=!1,u.value=""},T=()=>{y.push("/admin/messages/sent")},z=()=>{y.push("/admin/orders")},E=()=>{y.push("/admin/feedbacks")};return q(()=>{S()}),(i,e)=>{const d=a("el-button"),F=a("el-option"),N=a("el-select"),b=a("el-form-item"),V=a("el-input"),L=a("el-form"),$=a("el-card"),g=a("el-table-column"),h=a("el-table"),J=a("el-dialog");return w(),C("div",Q,[e[16]||(e[16]=n("h2",null,"消息管理",-1)),n("div",W,[t(d,{class:"pretty-btn",type:"primary",onClick:z},{default:l(()=>e[5]||(e[5]=[o("客户预约信息")])),_:1,__:[5]}),t(d,{class:"pretty-btn",type:"success",onClick:E},{default:l(()=>e[6]||(e[6]=[o("客户反馈信息")])),_:1,__:[6]})]),t($,{class:"send-msg-card"},{default:l(()=>[t(L,{"label-width":"80px",style:{"max-width":"700px",margin:"0 auto"}},{default:l(()=>[t(b,{label:"选择用户"},{default:l(()=>[n("div",X,[t(N,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),multiple:"",filterable:"",placeholder:"请选择用户",style:{flex:"1"}},{default:l(()=>[(w(!0),C(G,null,H(c.value,s=>(w(),K(F,{key:s.id,label:s.name||s.phone||"用户"+s.id,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(d,{class:"pretty-btn",type:"success",onClick:A,size:"small"},{default:l(()=>e[7]||(e[7]=[o("全体发送")])),_:1,__:[7]})])]),_:1}),t(b,{label:"消息内容"},{default:l(()=>[t(V,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=s=>m.value=s),type:"textarea",rows:4,placeholder:"请输入消息内容",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[t(d,{class:"pretty-btn",type:"primary",onClick:D},{default:l(()=>e[8]||(e[8]=[o("发送")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1}),n("div",Y,[e[10]||(e[10]=n("h3",{style:{"margin-bottom":"12px","text-align":"left"}},"用户列表（单独发送）",-1)),t(h,{data:c.value,style:{width:"100%"}},{default:l(()=>[t(g,{prop:"id",label:"用户ID",width:"100"}),t(g,{prop:"name",label:"用户名",width:"140"}),t(g,{prop:"phone",label:"手机号",width:"140"}),t(g,{label:"操作",width:"160"},{default:l(({row:s})=>[t(d,{class:"pretty-btn",size:"small",onClick:x=>B(s)},{default:l(()=>e[9]||(e[9]=[o("单独发送")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(J,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),title:"单独发送消息",width:"400px"},{footer:l(()=>[t(d,{class:"pretty-btn",onClick:e[3]||(e[3]=s=>_.value=!1)},{default:l(()=>e[13]||(e[13]=[o("取消")])),_:1,__:[13]}),t(d,{class:"pretty-btn",type:"primary",onClick:I},{default:l(()=>e[14]||(e[14]=[o("发送")])),_:1,__:[14]})]),default:l(()=>{var s,x,k;return[n("div",Z,[e[11]||(e[11]=o("发送给用户ID: ")),n("b",null,U((s=v.value)==null?void 0:s.id),1),e[12]||(e[12]=o("，用户名: ")),n("b",null,U(((x=v.value)==null?void 0:x.name)||((k=v.value)==null?void 0:k.phone)),1)]),t(V,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=O=>u.value=O),type:"textarea",rows:4,placeholder:"请输入消息内容"},null,8,["modelValue"])]}),_:1},8,["modelValue"]),n("div",ee,[t(d,{class:"pretty-btn",type:"primary",onClick:T},{default:l(()=>e[15]||(e[15]=[o("查看已发送记录")])),_:1,__:[15]})])])}}},ne=R(te,[["__scopeId","data-v-6676d7e5"]]);export{ne as default};
