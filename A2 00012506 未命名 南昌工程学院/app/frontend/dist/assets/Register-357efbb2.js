import{_ as U,u as E,r as u,a as q,k as I,b as f,o as h,c as x,d as i,e as s,f as n,i as B,l as F,h as M,E as p}from"./index-06309a7e.js";import{a as C}from"./auth-6129cfe6.js";import{C as y}from"./CommonButton-70b7e8fe.js";const N={class:"login-bg"},z={class:"login-card"},L={class:"captcha-image-container"},T=["src"],$={class:"register-link"},A={__name:"Register",setup(S){const P=E(),m=u(null),c=u(!1),r=q({name:"",phone:"",email:"",password:"",confirmPassword:"",captchaCode:""}),d=u(0),g=u(null),v=u(""),k={name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:(l,e,a)=>{e?/^1[3-9]\d{9}$/.test(e)?a():a(new Error("请输入正确的手机号格式")):a(new Error("请输入手机号"))},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(l,e,a)=>{e===""?a(new Error("请再次输入密码")):e!==r.password?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}],captchaCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"验证码为4-6位字符",trigger:"blur"}]},w=async()=>{try{await m.value.validateField("phone");const l=await C.sendCaptchaCode(r.phone,"register");l.success?(p.success("验证码已生成"),v.value=l.data.image,d.value=60,g.value=setInterval(()=>{d.value--,d.value<=0&&clearInterval(g.value)},1e3)):p.error(l.message||"生成失败")}catch(l){console.error("生成验证码失败:",l),p.error(l.message||"生成验证码失败")}},R=()=>{w()},b=async()=>{if(m.value)try{await m.value.validate(),c.value=!0;const{name:l,phone:e,email:a,password:t,captchaCode:_}=r;(await C.register({name:l,phone:e,email:a,password:t,smsCode:_})).success&&(p.success("注册成功，请登录"),P.push("/login"))}catch(l){p.error(l.message||"注册失败，请稍后重试")}finally{c.value=!1}};return I(()=>{g.value&&clearInterval(g.value)}),(l,e)=>{const a=f("el-input"),t=f("el-form-item"),_=f("router-link"),V=f("el-form");return h(),x("div",N,[e[8]||(e[8]=i("div",{class:"bg-shape circle1"},null,-1)),e[9]||(e[9]=i("div",{class:"bg-shape circle2"},null,-1)),e[10]||(e[10]=i("div",{class:"bg-shape triangle"},null,-1)),i("div",z,[e[7]||(e[7]=i("div",{class:"login-title"},"龙跃智慧停车场用户注册",-1)),s(V,{ref_key:"registerFormRef",ref:m,model:r,rules:k,"label-position":"top",onSubmit:B(b,["prevent"])},{default:n(()=>[s(t,{label:"姓名",prop:"name"},{default:n(()=>[s(a,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=o=>r.name=o),"prefix-icon":"User",placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),s(t,{label:"手机号",prop:"phone"},{default:n(()=>[s(a,{modelValue:r.phone,"onUpdate:modelValue":e[1]||(e[1]=o=>r.phone=o),"prefix-icon":"Phone",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),s(t,{label:"验证码",prop:"captchaCode"},{default:n(()=>[s(a,{modelValue:r.captchaCode,"onUpdate:modelValue":e[2]||(e[2]=o=>r.captchaCode=o),"prefix-icon":"Picture",placeholder:"请输入图片验证码"},null,8,["modelValue"]),i("div",L,[v.value?(h(),x("img",{key:0,src:v.value,onClick:R,class:"captcha-image",alt:"验证码"},null,8,T)):(h(),F(y,{key:1,type:"primary",size:"medium",disabled:d.value>0,text:d.value>0?`${d.value}s`:"获取验证码",onClick:w},null,8,["disabled","text"]))])]),_:1}),s(t,{label:"邮箱",prop:"email"},{default:n(()=>[s(a,{modelValue:r.email,"onUpdate:modelValue":e[3]||(e[3]=o=>r.email=o),"prefix-icon":"Message",placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),s(t,{label:"密码",prop:"password"},{default:n(()=>[s(a,{modelValue:r.password,"onUpdate:modelValue":e[4]||(e[4]=o=>r.password=o),type:"password","prefix-icon":"Lock",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),s(t,{label:"确认密码",prop:"confirmPassword"},{default:n(()=>[s(a,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>r.confirmPassword=o),type:"password","prefix-icon":"Lock",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1}),s(t,null,{default:n(()=>[s(y,{type:"primary",size:"large",loading:c.value,text:c.value?"注册中...":"注册",class:"login-btn",onClick:b},null,8,["loading","text"])]),_:1}),i("div",$,[s(_,{to:"/login"},{default:n(()=>e[6]||(e[6]=[M("已有账号？立即登录")])),_:1,__:[6]})])]),_:1},8,["model"])])])}}},K=U(A,[["__scopeId","data-v-c15db02f"]]);export{K as default};
