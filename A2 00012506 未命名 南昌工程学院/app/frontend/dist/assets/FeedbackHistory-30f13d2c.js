import{g as T,d as $}from"./feedback-8bd3c933.js";import{C as D}from"./CommonButton-70b7e8fe.js";import{_ as I,r as s,H as h,s as M,b as o,o as b,c as f,e as l,d as r,f as n,E as c,h as k,t as x}from"./index-06309a7e.js";const j={class:"feedback-history-view"},q={style:{"margin-bottom":"16px",display:"flex","align-items":"center",gap:"16px"}},A={key:0},G={style:{color:"#888","font-size":"12px"}},J={key:1,style:{color:"#aaa"}},K={style:{"margin-top":"18px","text-align":"right"}},C=8,L={__name:"FeedbackHistory",setup(O){const p=s([]),v=s(""),d=s("all"),u=s(1),i=s(0),_=async()=>{try{const t=await T({page:u.value,per_page:C,search:v.value});t.success?(p.value=t.data.map(e=>({...e,created_at:e.created_at.replace("T"," ").slice(0,19)})),i.value=t.total):(p.value=[],i.value=0,c.error(t.message||"获取反馈记录失败"))}catch(t){p.value=[],i.value=0,c.error("获取反馈记录失败"),console.error("获取反馈记录失败:",t)}},F=h(()=>{let t=p.value;return d.value==="replied"?t=t.filter(e=>!!e.reply):d.value==="unreplied"&&(t=t.filter(e=>!e.reply)),t}),V=h(()=>F.value),w=async t=>{try{const e=await $(t.id);e.success?(c.success("删除成功"),_()):c.error(e.message||"删除失败")}catch(e){c.error("删除失败"),console.error("删除反馈失败:",e)}},g=()=>{u.value=1,_()},z=()=>{_()};return M(_),(t,e)=>{const B=o("el-input"),y=o("el-option"),H=o("el-select"),m=o("el-table-column"),U=o("el-button"),E=o("el-popconfirm"),N=o("el-table"),P=o("el-pagination"),S=o("el-card");return b(),f("div",j,[l(D,{class:"back-btn",type:"secondary",size:"small",text:"返回",onClick:e[0]||(e[0]=a=>t.$router.back())}),e[6]||(e[6]=r("h2",null,"我的反馈记录",-1)),l(S,{style:{"max-width":"700px",margin:"0 auto"}},{default:n(()=>[r("div",q,[l(B,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),placeholder:"搜索反馈内容...",clearable:"",style:{width:"200px"},onInput:g},null,8,["modelValue"]),l(H,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),placeholder:"回复筛选",clearable:"",style:{width:"140px"},onChange:g},{default:n(()=>[l(y,{label:"全部",value:"all"}),l(y,{label:"已回复",value:"replied"}),l(y,{label:"未回复",value:"unreplied"})]),_:1},8,["modelValue"])]),l(N,{data:V.value,style:{width:"100%"}},{default:n(()=>[l(m,{prop:"created_at",label:"提交时间",width:"180"}),l(m,{prop:"content",label:"反馈内容"}),l(m,{label:"管理员回复"},{default:n(({row:a})=>[a.reply?(b(),f("div",A,[k(x(a.reply),1),e[4]||(e[4]=r("br",null,null,-1)),r("span",G,x(a.reply_at?a.reply_at.replace("T"," ").slice(0,19):""),1)])):(b(),f("div",J,"暂未回复"))]),_:1}),l(m,{label:"操作",width:"90"},{default:n(({row:a})=>[l(E,{title:"确定删除这条反馈？",onConfirm:Q=>w(a)},{default:n(()=>[l(U,{type:"danger",size:"small"},{default:n(()=>e[5]||(e[5]=[k("删除")])),_:1,__:[5]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),r("div",K,[l(P,{background:"",layout:"prev, pager, next, jumper",total:i.value,"page-size":C,"current-page":u.value,"onUpdate:currentPage":e[3]||(e[3]=a=>u.value=a),onCurrentChange:z},null,8,["total","current-page"])])]),_:1})])}}},Y=I(L,[["__scopeId","data-v-94c4f244"]]);export{Y as default};
