import{_ as E,r as p,H as K,w as X,s as Y,b as k,o as v,c as g,d as e,e as l,f as _,v as V,W as Z,S as I,j as M,F as ee,J as se,C as U,t as C,i as j,l as te,E as u,L as z,u as ae,h as ne}from"./index-06309a7e.js";import{_ as oe}from"./bujutu-9805eb74.js";import{C as x}from"./CommonButton-70b7e8fe.js";import{a as $}from"./index-d5848531.js";const le={class:"message-quick-view"},ie={class:"message-notification"},re={class:"message-panel"},de={class:"message-actions"},ce={class:"message-list"},ue={key:0,class:"empty-message"},ve=["onClick"],me={class:"message-header"},pe={class:"message-status"},ge={key:0,class:"fa fa-circle unread-dot"},_e={key:1,class:"read-dot"},fe={class:"message-time"},ye={class:"message-content"},xe={class:"message-actions-item"},ke={key:0,class:"message-pagination"},we={class:"message-detail"},be={class:"detail-header"},Ce={class:"detail-time"},$e={class:"detail-content"},he={class:"dialog-footer"},Me={__name:"MessageQuickView",setup(F){const m=p(!1),i=p(!1),o=p([]),s=p(null),f=p(1),d=p(10),B=p(0),P=p(!1),h=K(()=>o.value.filter(t=>!t.is_read).length),w=async()=>{try{P.value=!0;const t=await $.get("/api/messages",{params:{page:f.value,size:d.value}});o.value=t.data||[],B.value=t.total||o.value.length}catch(t){console.error("获取消息失败:",t),u.error("获取消息失败")}finally{P.value=!1}},H=()=>{m.value=!m.value,m.value&&w()},N=t=>{s.value=t,i.value=!0,t.is_read||T(t.id)},R=t=>{s.value=t,i.value=!0},T=async t=>{var a;try{await $.put(`/messages/${t}/read`);const r=o.value.find(c=>c.id===t);r&&(r.is_read=!0),((a=s.value)==null?void 0:a.id)===t&&(s.value.is_read=!0),u.success("已标记为已读")}catch(r){console.error("标记已读失败:",r),u.error("标记已读失败")}},A=async()=>{try{await z.confirm("确定要将所有消息标记为已读吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});for(const t of o.value)t.is_read||(await $.put(`/messages/${t.id}/read`),t.is_read=!0);u.success("全部标记为已读")}catch(t){t!=="cancel"&&(console.error("标记已读失败:",t),u.error("标记已读失败"))}},L=async t=>{var a;try{await z.confirm("确定要删除这条消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $.delete(`/messages/${t}`),o.value=o.value.filter(r=>r.id!==t),((a=s.value)==null?void 0:a.id)===t&&(i.value=!1,s.value=null),u.success("删除成功")}catch(r){r!=="cancel"&&(console.error("删除消息失败:",r),u.error("删除消息失败"))}},O=async()=>{try{await z.confirm("确定要清空所有消息吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await $.delete("/api/messages/clear-all"),o.value=[],i.value=!1,s.value=null,u.success("清空成功")}catch(t){t!=="cancel"&&(console.error("清空消息失败:",t),u.error("清空消息失败"))}},Q=t=>{d.value=t,f.value=1,w()},q=t=>{f.value=t,w()},S=t=>{if(!t)return"";const a=new Date(t),c=new Date-a;return c<6e4?"刚刚":c<36e5?`${Math.floor(c/6e4)}分钟前`:c<864e5?`${Math.floor(c/36e5)}小时前`:a.toLocaleDateString()};return X(m,t=>{t&&w()}),Y(()=>{w()}),(t,a)=>{const r=k("el-icon"),c=k("el-badge"),J=k("el-pagination"),W=k("el-drawer"),G=k("el-dialog");return v(),g("div",le,[e("div",ie,[l(c,{value:h.value,hidden:h.value===0,class:"message-badge"},{default:_(()=>[l(x,{type:"primary",size:"medium",onClick:H,class:"message-btn"},{default:_(()=>[l(r,null,{default:_(()=>[l(V(Z))]),_:1}),a[6]||(a[6]=e("span",{class:"btn-text"},"消息",-1))]),_:1,__:[6]})]),_:1},8,["value","hidden"])]),l(W,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=n=>m.value=n),title:"消息中心",direction:"rtl",size:"400px","with-header":!0},{default:_(()=>[e("div",re,[e("div",de,[l(x,{type:"secondary",size:"small",text:"全部标为已读",onClick:A,disabled:h.value===0},null,8,["disabled"]),l(x,{type:"danger",size:"small",text:"清空",onClick:O,disabled:o.value.length===0},null,8,["disabled"])]),e("div",ce,[o.value.length===0?(v(),g("div",ue,[l(r,null,{default:_(()=>[l(V(I))]),_:1}),a[7]||(a[7]=e("p",null,"暂无消息",-1))])):M("",!0),(v(!0),g(ee,null,se(o.value,n=>(v(),g("div",{key:n.id,class:U(["message-item",{unread:!n.is_read}]),onClick:y=>N(n)},[e("div",me,[e("span",pe,[n.is_read?(v(),g("span",_e)):(v(),g("i",ge))]),e("span",fe,C(S(n.created_at)),1)]),e("div",ye,C(n.content),1),e("div",xe,[l(x,{type:"secondary",size:"small",text:"查看详情",onClick:j(y=>R(n),["stop"])},null,8,["onClick"]),l(x,{type:"danger",size:"small",text:"删除",onClick:j(y=>L(n.id),["stop"])},null,8,["onClick"])])],10,ve))),128))]),o.value.length>0?(v(),g("div",ke,[l(J,{"current-page":f.value,"onUpdate:currentPage":a[0]||(a[0]=n=>f.value=n),"page-size":d.value,"onUpdate:pageSize":a[1]||(a[1]=n=>d.value=n),"page-sizes":[10,20,50],total:B.value,layout:"total, sizes, prev, pager, next",onSizeChange:Q,onCurrentChange:q},null,8,["current-page","page-size","total"])])):M("",!0)])]),_:1},8,["modelValue"]),l(G,{modelValue:i.value,"onUpdate:modelValue":a[5]||(a[5]=n=>i.value=n),title:"消息详情",width:"500px","close-on-click-modal":!1},{footer:_(()=>{var n;return[e("div",he,[l(x,{type:"secondary",size:"medium",text:"关闭",onClick:a[3]||(a[3]=y=>i.value=!1)}),(n=s.value)!=null&&n.is_read?M("",!0):(v(),te(x,{key:0,type:"primary",size:"medium",text:"标为已读",onClick:a[4]||(a[4]=y=>{var b;return T((b=s.value)==null?void 0:b.id)})}))])]}),default:_(()=>{var n,y,b,D;return[e("div",we,[e("div",be,[e("span",Ce,C(S((n=s.value)==null?void 0:n.created_at)),1),e("span",{class:U(["detail-status",{unread:!((y=s.value)!=null&&y.is_read)}])},C((b=s.value)!=null&&b.is_read?"已读":"未读"),3)]),e("div",$e,C((D=s.value)==null?void 0:D.content),1)])]}),_:1},8,["modelValue"])])}}},ze=E(Me,[["__scopeId","data-v-45e25526"]]);const Ve={class:"fade-in"},Be={class:"mb-6"},Pe={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-6 mb-6"},Te={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"},Se={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-6"},De={class:"flex justify-between items-center mb-6"},Ue={class:"relative overflow-hidden rounded-lg"},je=["src"],Ee={__name:"Home",setup(F){const m=ae();function i(o){const s={ParkingMap:"ParkingMap",Fee:"UserBills",Orders:"UserOrders"};m.push({name:s[o]||o})}return(o,s)=>{const f=k("el-button");return v(),g("div",Ve,[s[15]||(s[15]=e("div",{class:"mb-6"},[e("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"智慧停车"),e("p",{class:"text-gray-500 mt-1"},"便捷的停车服务，让您的出行更加轻松")],-1)),e("div",Be,[l(ze)]),e("div",Pe,[s[11]||(s[11]=e("div",{class:"flex justify-between items-center mb-6"},[e("h3",{class:"font-medium text-lg"},"快捷服务"),e("p",{class:"text-gray-500 text-sm"},"选择您需要的服务")],-1)),e("div",Te,[e("div",{class:"action-card-modern",onClick:s[0]||(s[0]=d=>i("ParkingReservation"))},s[6]||(s[6]=[e("div",{class:"action-icon bg-primary/10 text-primary"},[e("i",{class:"fa fa-calendar"})],-1),e("span",{class:"action-text"},"预订车位",-1)])),e("div",{class:"action-card-modern",onClick:s[1]||(s[1]=d=>i("ParkingStatus"))},s[7]||(s[7]=[e("div",{class:"action-icon bg-success/10 text-success"},[e("i",{class:"fa fa-car"})],-1),e("span",{class:"action-text"},"车位查看",-1)])),e("div",{class:"action-card-modern",onClick:s[2]||(s[2]=d=>i("ParkingMap"))},s[8]||(s[8]=[e("div",{class:"action-icon bg-info/10 text-info"},[e("i",{class:"fa fa-map"})],-1),e("span",{class:"action-text"},"停车场布局",-1)])),e("div",{class:"action-card-modern",onClick:s[3]||(s[3]=d=>i("Fee"))},s[9]||(s[9]=[e("div",{class:"action-icon bg-warning/10 text-warning"},[e("i",{class:"fa fa-money"})],-1),e("span",{class:"action-text"},"收费明细",-1)])),e("div",{class:"action-card-modern",onClick:s[4]||(s[4]=d=>i("Orders"))},s[10]||(s[10]=[e("div",{class:"action-icon bg-purple-500/10 text-purple-500"},[e("i",{class:"fa fa-list"})],-1),e("span",{class:"action-text"},"订单查看",-1)]))])]),e("div",Se,[e("div",De,[s[13]||(s[13]=e("h3",{class:"font-medium text-lg"},"龙跃园区停车场布局",-1)),l(f,{type:"primary",size:"small",onClick:s[5]||(s[5]=d=>i("ParkingMap"))},{default:_(()=>s[12]||(s[12]=[ne(" 查看详情 ")])),_:1,__:[12]})]),e("div",Ue,[e("img",{src:V(oe),alt:"停车场布局图",class:"w-full h-auto object-cover hover:scale-105 transition-transform duration-300"},null,8,je),s[14]||(s[14]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"},null,-1))])])])}}},Ae=E(Ee,[["__scopeId","data-v-295ad421"]]);export{Ae as default};
