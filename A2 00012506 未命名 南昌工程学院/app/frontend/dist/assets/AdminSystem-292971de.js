import{_ as N,r,s as O,b as s,I as j,o as w,c as B,e as l,f as a,E as u,d as m,D as T,l as G,v as H,O as J,j as K}from"./index-06309a7e.js";import{C as V}from"./CommonButton-70b7e8fe.js";import{a as f}from"./index-d5848531.js";const P={class:"admin-system-container"},Q={class:"log-section"},W={class:"log-header"},X={key:0,class:"empty-logs"},Y={__name:"AdminSystem",setup(Z){const k=r(null),C=r(null),g=r(!1),v=r(!1),p=r(!1),o=r({first:5,next:2,max:30}),d=r({timeout:72}),y=r([]),D=r(0),F={first:[{required:!0,message:"请输入首小时费用",trigger:"blur"},{type:"number",min:0,message:"费用不能为负数",trigger:"blur"}],next:[{required:!0,message:"请输入后续每小时费用",trigger:"blur"},{type:"number",min:0,message:"费用不能为负数",trigger:"blur"}],max:[{required:!0,message:"请输入24小时封顶费用",trigger:"blur"},{type:"number",min:0,message:"费用不能为负数",trigger:"blur"}]},L={timeout:[{required:!0,message:"请输入超时停车提醒时间",trigger:"blur"},{type:"number",min:1,message:"时间必须大于0",trigger:"blur"}]},S=async()=>{try{const e=await f.get("/api/system/config");e.success&&e.data&&(o.value=e.data.fee||{first:5,next:2,max:30},d.value=e.data.alarm||{timeout:72})}catch(e){console.error("获取配置失败:",e)}},q=async()=>{try{await k.value.validate(),g.value=!0;const e=await f.put("/api/system/fee-config",o.value);e.success?(u.success("收费标准保存成功"),await h("修改收费标准",`首小时: ${o.value.first}元, 后续每小时: ${o.value.next}元, 24小时封顶: ${o.value.max}元`)):u.error(e.message||"保存失败")}catch(e){e!=="cancel"&&(console.error("保存收费标准失败:",e),u.error("保存失败，请重试"))}finally{g.value=!1}},z=async()=>{try{await C.value.validate(),v.value=!0;const e=await f.put("/api/system/alarm-config",d.value);e.success?(u.success("告警规则保存成功"),await h("设置超时停车告警",`超时停车提醒时间: ${d.value.timeout}小时`)):u.error(e.message||"保存失败")}catch(e){e!=="cancel"&&(console.error("保存告警规则失败:",e),u.error("保存失败，请重试"))}finally{v.value=!1}},b=async()=>{try{p.value=!0;const e=await f.get("/api/system/logs",{params:{page:1,size:50}});e.success?(y.value=e.data||[],D.value=e.total||0):u.error(e.message||"获取日志失败")}catch(e){console.error("获取操作日志失败:",e),u.error("获取日志失败")}finally{p.value=!1}},h=async(e,t="")=>{try{const n={action:e,details:t,timestamp:new Date().toISOString()};await f.post("/api/system/logs",n),await b()}catch(n){console.error("添加操作日志失败:",n)}};return O(()=>{S(),b()}),(e,t)=>{const n=s("el-input"),c=s("el-form-item"),M=s("el-form"),x=s("el-card"),R=s("el-col"),A=s("el-row"),U=s("el-divider"),_=s("el-table-column"),$=s("el-table"),E=s("el-icon"),I=j("loading");return w(),B("div",P,[l(x,null,{header:a(()=>t[4]||(t[4]=[m("h3",null,"系统运维",-1)])),default:a(()=>[l(A,{gutter:20},{default:a(()=>[l(R,{span:12},{default:a(()=>[l(x,null,{default:a(()=>[t[5]||(t[5]=m("h4",null,"收费标准配置",-1)),l(M,{model:o.value,rules:F,ref_key:"feeFormRef",ref:k,"label-width":"120px"},{default:a(()=>[l(c,{label:"首小时",prop:"first"},{default:a(()=>[l(n,{modelValue:o.value.first,"onUpdate:modelValue":t[0]||(t[0]=i=>o.value.first=i),modelModifiers:{number:!0},suffix:"元",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),l(c,{label:"后续每小时",prop:"next"},{default:a(()=>[l(n,{modelValue:o.value.next,"onUpdate:modelValue":t[1]||(t[1]=i=>o.value.next=i),modelModifiers:{number:!0},suffix:"元",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),l(c,{label:"24小时封顶",prop:"max"},{default:a(()=>[l(n,{modelValue:o.value.max,"onUpdate:modelValue":t[2]||(t[2]=i=>o.value.max=i),modelModifiers:{number:!0},suffix:"元",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),l(c,null,{default:a(()=>[l(V,{type:"primary",size:"medium",text:"保存",loading:g.value,onClick:q},null,8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1,__:[5]})]),_:1}),l(R,{span:12},{default:a(()=>[l(x,null,{default:a(()=>[t[6]||(t[6]=m("h4",null,"告警规则设置",-1)),l(M,{model:d.value,rules:L,ref_key:"alarmFormRef",ref:C,"label-width":"120px"},{default:a(()=>[l(c,{label:"超时停车提醒(小时)",prop:"timeout"},{default:a(()=>[l(n,{modelValue:d.value.timeout,"onUpdate:modelValue":t[3]||(t[3]=i=>d.value.timeout=i),modelModifiers:{number:!0},suffix:"小时",type:"number",min:"1"},null,8,["modelValue"])]),_:1}),l(c,null,{default:a(()=>[l(V,{type:"primary",size:"medium",text:"保存",loading:v.value,onClick:z},null,8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1,__:[6]})]),_:1})]),_:1}),l(U),m("div",Q,[m("div",W,[t[7]||(t[7]=m("h4",null,"操作日志审计",-1)),l(V,{type:"secondary",size:"small",text:"刷新",onClick:b})]),T((w(),G($,{data:y.value,style:{width:"100%"}},{default:a(()=>[l(_,{prop:"time",label:"时间",width:"180"}),l(_,{prop:"user",label:"管理员",width:"120"}),l(_,{prop:"action",label:"操作内容"}),l(_,{prop:"details",label:"详细信息"})]),_:1},8,["data"])),[[I,p.value]]),y.value.length===0&&!p.value?(w(),B("div",X,[l(E,null,{default:a(()=>[l(H(J))]),_:1}),t[8]||(t[8]=m("p",null,"暂无操作日志",-1))])):K("",!0)])]),_:1})])}}},ae=N(Y,[["__scopeId","data-v-c2ed561d"]]);export{ae as default};
