import{g as be,c as we,d as De,p as Ve,a as ke}from"./orders-5a34db32.js";import{g as Ce}from"./users-b6f22b71.js";import{g as Se}from"./parking-f1dd034f.js";import{_ as $e,r as v,H as $,s as xe,b as c,I as ze,o as p,c as M,d as s,e as l,f as n,t as d,l as x,j as z,E as _,h as u,D as Oe,L as E}from"./index-06309a7e.js";import"./index-d5848531.js";import"./cacheManager-5937ebc8.js";const Te={class:"admin-orders-container"},Ue={class:"page-header"},Me={class:"header-actions"},Be={class:"stats-cards"},Ie={class:"stat-card"},Le={class:"stat-content"},Ae={class:"stat-value"},Ye={class:"stat-card"},Ne={class:"stat-content"},Pe={class:"stat-value"},Ee={class:"stat-card"},Fe={class:"stat-content"},qe={class:"stat-value"},je={class:"stat-card"},He={class:"stat-content"},Ke={class:"stat-value"},Ze={class:"filter-section"},Ge={class:"filter-left"},Je={class:"filter-right"},Qe={key:0,class:"filter-stats"},Re={class:"user-info"},We={class:"user-name"},Xe={class:"user-phone"},et={class:"spot-info"},tt={class:"spot-number"},at={class:"spot-zone"},st={class:"time-info"},lt={class:"start-time"},nt={class:"end-time"},ot={class:"amount"},it={key:0},dt={key:1,class:"text-gray-400"},rt={class:"action-buttons"},ut={class:"pagination-wrapper"},ct={__name:"AdminOrders",setup(mt){const k=v([]),B=v([]),I=v([]),U=v(!1),O=v(!1),g=v(1),L=v(20),y=v(""),i=v([]),h=v(""),Z=[{text:"最近一周",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,t]}},{text:"最近一个月",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,t]}},{text:"最近三个月",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,t]}},{text:"今天",value:()=>{const t=new Date;return[t,t]}},{text:"昨天",value:()=>{const t=new Date;return t.setTime(t.getTime()-3600*1e3*24),[t,t]}}],r=v({user_id:"",spot_id:"",start_time:"",end_time:"",amount:"",status:"未支付",pay_method:""}),F=$(()=>k.value.length),G=$(()=>k.value.filter(t=>t.status==="未支付").length),J=$(()=>k.value.filter(t=>t.status==="已完成").length),Q=$(()=>k.value.filter(t=>t.status==="已取消").length),q=$(()=>{let t=k.value;if(y.value&&(t=t.filter(e=>e.status===y.value)),i.value&&i.value.length===2){const e=new Date(i.value[0]),o=new Date(i.value[1]);o.setHours(23,59,59,999),console.log("日期筛选范围:",{startDate:e.toISOString(),endDate:o.toISOString(),totalOrders:t.length}),t=t.filter(m=>{const b=new Date(m.start_time),w=new Date(m.end_time),D=b>=e&&b<=o||w>=e&&w<=o||b<=e&&w>=o;return D||console.log("订单被过滤:",{orderId:m.id,orderStartTime:b.toISOString(),orderEndTime:w.toISOString()}),D}),console.log("筛选后订单数量:",t.length)}if(h.value){const e=h.value.toLowerCase();t=t.filter(o=>o.id.toString().includes(e)||A(o.user_id).toLowerCase().includes(e)||Y(o.user_id).includes(e)||N(o.spot_id).toLowerCase().includes(e))}return t}),R=$(()=>y.value||i.value&&i.value.length===2||h.value),W=t=>{if(!t||t.length!==2)return"";const e=new Date(t[0]),o=new Date(t[1]);return`${e.toLocaleDateString()} 至 ${o.toLocaleDateString()}`},A=t=>{const e=B.value.find(o=>o.id===t);return e?e.name:`用户${t}`},Y=t=>{const e=B.value.find(o=>o.id===t);return e?e.phone:"-"},N=t=>{const e=I.value.find(o=>o.id===t);return e?e.spot_number:`车位${t}`},j=t=>{const e=I.value.find(o=>o.id===t);return e?`${e.zone}区`:"-"},C=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",X=t=>({未支付:"warning",已完成:"success",已取消:"danger"})[t]||"info",S=async()=>{U.value=!0;try{const t=await be({per_page:1e3});k.value=t.data||[]}catch(t){_.error(t.message||"获取订单失败")}finally{U.value=!1}},ee=async()=>{try{const t=await Ce({per_page:1e3});B.value=t.data||[]}catch(t){console.error("获取用户列表失败:",t)}},H=async()=>{try{const t=await Se({per_page:1e3});I.value=t.data||[]}catch(t){console.error("获取车位列表失败:",t)}},te=()=>{g.value=1},ae=()=>{if(g.value=1,i.value&&i.value.length===2){const t=new Date(i.value[0]),e=new Date(i.value[1]);_.success(`已筛选 ${t.toLocaleDateString()} 至 ${e.toLocaleDateString()} 的订单`)}else(!i.value||i.value.length===0)&&_.info("已清除日期筛选")},se=()=>{g.value=1},le=()=>{y.value="",i.value=[],h.value="",g.value=1,_.success("已清除所有筛选条件")},ne=t=>{L.value=t,g.value=1},oe=t=>{g.value=t},ie=()=>{O.value=!0,K()},K=()=>{r.value={user_id:"",spot_id:"",start_time:"",end_time:"",amount:"",status:"未支付",pay_method:""}},de=async()=>{try{await we(r.value),_.success("新增成功"),O.value=!1,S()}catch(t){_.error(t.message||"新增失败")}},re=async t=>{try{await De(t),_.success("删除成功"),S()}catch(e){_.error(e.message||"删除失败")}},ue=t=>{E.alert(`
订单详情：
订单号：${t.id}
用户：${A(t.user_id)} (${Y(t.user_id)})
车位：${N(t.spot_id)} (${j(t.spot_id)})
开始时间：${C(t.start_time)}
结束时间：${C(t.end_time)}
金额：¥${t.amount||"0.00"}
状态：${t.status}
支付方式：${t.pay_method||"-"}
创建时间：${C(t.created_at)}
  `,"订单详情",{confirmButtonText:"确定"})},ce=async t=>{try{await E.confirm(`确定要将订单 ${t.id} 标记为已支付吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ve(t.id,"管理员标记"),_.success("标记成功"),S()}catch(e){e!=="cancel"&&_.error(e.message||"标记失败")}},me=async t=>{try{await E.confirm(`确定要取消订单 ${t.id} 吗？
取消后车位将重新变为可用状态。`,"确认取消订单",{confirmButtonText:"确定取消",cancelButtonText:"取消",type:"warning"}),await ke(t.id),_.success("订单已取消，车位已释放"),await Promise.all([S(),H()])}catch(e){e!=="cancel"&&_.error(e.message||"取消订单失败")}};return xe(async()=>{await Promise.all([S(),ee(),H()])}),(t,e)=>{const o=c("el-button"),m=c("el-option"),b=c("el-select"),w=c("el-date-picker"),D=c("el-input"),T=c("el-tag"),f=c("el-table-column"),_e=c("el-popconfirm"),ve=c("el-table"),pe=c("el-pagination"),fe=c("el-card"),V=c("el-form-item"),ge=c("el-form"),ye=c("el-dialog"),he=ze("loading");return p(),M("div",Te,[s("div",Ue,[e[16]||(e[16]=s("div",{class:"header-content"},[s("h2",{class:"page-title"},"订单管理"),s("p",{class:"page-subtitle"},"管理系统中的所有停车订单")],-1)),s("div",Me,[l(o,{type:"primary",onClick:ie,class:"add-btn"},{default:n(()=>e[14]||(e[14]=[s("i",{class:"fa fa-plus mr-2"},null,-1),u("新增订单 ")])),_:1,__:[14]}),l(o,{onClick:S,loading:U.value,class:"refresh-btn"},{default:n(()=>e[15]||(e[15]=[s("i",{class:"fa fa-refresh mr-2"},null,-1),u("刷新 ")])),_:1,__:[15]},8,["loading"])])]),s("div",Be,[s("div",Ie,[e[18]||(e[18]=s("div",{class:"stat-icon bg-blue-500"},[s("i",{class:"fa fa-list"})],-1)),s("div",Le,[s("div",Ae,d(F.value),1),e[17]||(e[17]=s("div",{class:"stat-label"},"总订单数",-1))])]),s("div",Ye,[e[20]||(e[20]=s("div",{class:"stat-icon bg-orange-500"},[s("i",{class:"fa fa-clock-o"})],-1)),s("div",Ne,[s("div",Pe,d(G.value),1),e[19]||(e[19]=s("div",{class:"stat-label"},"待支付",-1))])]),s("div",Ee,[e[22]||(e[22]=s("div",{class:"stat-icon bg-green-500"},[s("i",{class:"fa fa-check-circle"})],-1)),s("div",Fe,[s("div",qe,d(J.value),1),e[21]||(e[21]=s("div",{class:"stat-label"},"已完成",-1))])]),s("div",je,[e[24]||(e[24]=s("div",{class:"stat-icon bg-red-500"},[s("i",{class:"fa fa-times-circle"})],-1)),s("div",He,[s("div",Ke,d(Q.value),1),e[23]||(e[23]=s("div",{class:"stat-label"},"已取消",-1))])])]),s("div",Ze,[s("div",Ge,[l(b,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),placeholder:"状态筛选",clearable:"",onChange:te},{default:n(()=>[l(m,{label:"全部状态",value:""}),l(m,{label:"未支付",value:"未支付"}),l(m,{label:"已完成",value:"已完成"}),l(m,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"]),l(w,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ae,class:"ml-3",shortcuts:Z},null,8,["modelValue"])]),s("div",Je,[l(D,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),placeholder:"搜索订单号、用户名或车牌号","prefix-icon":"Search",onInput:se,clearable:"",class:"search-input"},null,8,["modelValue"]),l(o,{onClick:le,type:"info",size:"small",class:"ml-2"},{default:n(()=>e[25]||(e[25]=[s("i",{class:"fa fa-times mr-1"},null,-1),u("清除筛选 ")])),_:1,__:[25]})])]),R.value?(p(),M("div",Qe,[l(T,{type:"info",size:"small"},{default:n(()=>[u(" 筛选结果: "+d(q.value.length)+" 条订单 ",1)]),_:1}),y.value?(p(),x(T,{key:0,type:"warning",size:"small",class:"ml-2"},{default:n(()=>[u(" 状态: "+d(y.value),1)]),_:1})):z("",!0),i.value&&i.value.length===2?(p(),x(T,{key:1,type:"success",size:"small",class:"ml-2"},{default:n(()=>[u(" 日期: "+d(W(i.value)),1)]),_:1})):z("",!0),h.value?(p(),x(T,{key:2,type:"primary",size:"small",class:"ml-2"},{default:n(()=>[u(" 关键词: "+d(h.value),1)]),_:1})):z("",!0)])):z("",!0),l(fe,{class:"orders-table-card"},{default:n(()=>[Oe((p(),x(ve,{data:q.value,style:{width:"100%"},stripe:""},{default:n(()=>[l(f,{prop:"id",label:"订单号",width:"80"}),l(f,{label:"用户信息",width:"150"},{default:n(({row:a})=>[s("div",Re,[s("div",We,d(A(a.user_id)),1),s("div",Xe,d(Y(a.user_id)),1)])]),_:1}),l(f,{label:"车位信息",width:"120"},{default:n(({row:a})=>[s("div",et,[s("div",tt,d(N(a.spot_id)),1),s("div",at,d(j(a.spot_id)),1)])]),_:1}),l(f,{label:"预约时间",width:"200"},{default:n(({row:a})=>[s("div",st,[s("div",lt,"开始: "+d(C(a.start_time)),1),s("div",nt,"结束: "+d(C(a.end_time)),1)])]),_:1}),l(f,{prop:"amount",label:"金额",width:"100"},{default:n(({row:a})=>[s("span",ot,"¥"+d(a.amount||"0.00"),1)]),_:1}),l(f,{label:"状态",width:"100"},{default:n(({row:a})=>[l(T,{type:X(a.status),size:"small"},{default:n(()=>[u(d(a.status),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"pay_method",label:"支付方式",width:"100"},{default:n(({row:a})=>[a.pay_method?(p(),M("span",it,d(a.pay_method),1)):(p(),M("span",dt,"-"))]),_:1}),l(f,{prop:"created_at",label:"创建时间",width:"150"},{default:n(({row:a})=>[u(d(C(a.created_at)),1)]),_:1}),l(f,{label:"操作",width:"200",fixed:"right"},{default:n(({row:a})=>[s("div",rt,[l(o,{size:"small",onClick:P=>ue(a),class:"view-btn"},{default:n(()=>e[26]||(e[26]=[s("i",{class:"fa fa-eye"},null,-1),u(" 查看 ")])),_:2,__:[26]},1032,["onClick"]),a.status==="未支付"?(p(),x(o,{key:0,size:"small",type:"success",onClick:P=>ce(a),class:"pay-btn"},{default:n(()=>e[27]||(e[27]=[s("i",{class:"fa fa-check"},null,-1),u(" 标记已付 ")])),_:2,__:[27]},1032,["onClick"])):z("",!0),a.status==="未支付"||a.status==="进行中"?(p(),x(o,{key:1,size:"small",type:"warning",onClick:P=>me(a),class:"cancel-btn"},{default:n(()=>e[28]||(e[28]=[s("i",{class:"fa fa-times"},null,-1),u(" 取消订单 ")])),_:2,__:[28]},1032,["onClick"])):z("",!0),l(_e,{title:"确定要删除该订单吗？",onConfirm:P=>re(a.id)},{reference:n(()=>[l(o,{size:"small",type:"danger",class:"delete-btn"},{default:n(()=>e[29]||(e[29]=[s("i",{class:"fa fa-trash"},null,-1),u(" 删除 ")])),_:1,__:[29]})]),_:2},1032,["onConfirm"])])]),_:1})]),_:1},8,["data"])),[[he,U.value]]),s("div",ut,[l(pe,{"current-page":g.value,"onUpdate:currentPage":e[3]||(e[3]=a=>g.value=a),"page-size":L.value,"onUpdate:pageSize":e[4]||(e[4]=a=>L.value=a),"page-sizes":[10,20,50,100],total:F.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:oe},null,8,["current-page","page-size","total"])])]),_:1}),l(ye,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=a=>O.value=a),title:"新增订单",onClosed:K},{footer:n(()=>[l(o,{onClick:e[12]||(e[12]=a=>O.value=!1)},{default:n(()=>e[30]||(e[30]=[u("取消")])),_:1,__:[30]}),l(o,{type:"primary",onClick:de},{default:n(()=>e[31]||(e[31]=[u("确定")])),_:1,__:[31]})]),default:n(()=>[l(ge,{model:r.value,"label-width":"80px"},{default:n(()=>[l(V,{label:"用户ID",required:""},{default:n(()=>[l(D,{modelValue:r.value.user_id,"onUpdate:modelValue":e[5]||(e[5]=a=>r.value.user_id=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"车位ID",required:""},{default:n(()=>[l(D,{modelValue:r.value.spot_id,"onUpdate:modelValue":e[6]||(e[6]=a=>r.value.spot_id=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"开始时间",required:""},{default:n(()=>[l(w,{modelValue:r.value.start_time,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value.start_time=a),type:"datetime"},null,8,["modelValue"])]),_:1}),l(V,{label:"结束时间",required:""},{default:n(()=>[l(w,{modelValue:r.value.end_time,"onUpdate:modelValue":e[8]||(e[8]=a=>r.value.end_time=a),type:"datetime"},null,8,["modelValue"])]),_:1}),l(V,{label:"金额(元)",required:""},{default:n(()=>[l(D,{modelValue:r.value.amount,"onUpdate:modelValue":e[9]||(e[9]=a=>r.value.amount=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"状态"},{default:n(()=>[l(b,{modelValue:r.value.status,"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.status=a)},{default:n(()=>[l(m,{label:"未支付",value:"未支付"}),l(m,{label:"已完成",value:"已完成"}),l(m,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"支付方式"},{default:n(()=>[l(b,{modelValue:r.value.pay_method,"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.pay_method=a)},{default:n(()=>[l(m,{label:"支付宝",value:"支付宝"}),l(m,{label:"微信",value:"微信"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ht=$e(ct,[["__scopeId","data-v-ea7cfa07"]]);export{ht as default};
