import{g as N,c as ge,u as O,d as _e}from"./parking-f1dd034f.js";import{_ as be,r as v,H as ye,a as K,s as xe,k as he,E as r,b as i,I as ke,o as f,c as y,d as s,e as a,f as o,t as x,C as H,D as Ve,l as J,F as k,J as V,h as g,K as we,L as Ce}from"./index-06309a7e.js";import"./cacheManager-5937ebc8.js";const ze={class:"fade-in"},Se={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-5 mb-6"},Ue={class:"flex flex-wrap gap-4 items-center"},Ae={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},De={class:"flex items-center gap-2"},Ee={class:"flex gap-2"},Be={class:"flex justify-between items-center mb-6"},Me={class:"flex gap-2"},Fe={class:"flex items-center gap-4"},Re={class:"text-sm text-gray-500"},Ie={class:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden"},Te={class:"flex gap-1"},je={class:"px-6 py-4 border-t border-gray-100 flex justify-between items-center"},$e={class:"text-sm text-gray-500"},qe={class:"dialog-footer"},Le={__name:"AdminParkingManagement",setup(Ne){const S=v([]),E=v(!1),B=v(!1),_=v(!0),w=v(0),b=v(1),h=v(10),C=v(!1),U=v("add"),A=v(null),Z={spot_number:"车位号",zone:"分区",type:"类型",status:"状态",is_active:"是否启用"},G=ye(()=>S.value.length===0?[]:Object.keys(S.value[0]).filter(t=>!["id","created_at","updated_at"].includes(t))),F=[{value:"A",label:"A区"},{value:"B",label:"B区"},{value:"C",label:"C区"},{value:"D",label:"D区"},{value:"E",label:"E区"},{value:"F",label:"F区"}],R=[{value:"普通",label:"普通"},{value:"新能源",label:"新能源"},{value:"无障碍",label:"无障碍"}],I=[{value:"空闲",label:"空闲"},{value:"已占用",label:"已占用"},{value:"已预约",label:"已预约"},{value:"维修",label:"维修"}],p=K({zone:"",type:"",status:""}),n=K({id:"",spot_number:"",zone:"",type:"",status:"空闲"}),Q={spot_number:[{required:!0,message:"请输入车位号",trigger:"blur"},{pattern:/^[A-Z0-9]{1,10}$/,message:"车位号只能包含大写字母和数字，长度1-10",trigger:"blur"}],zone:[{required:!0,message:"请选择分区",trigger:"change"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]};xe(()=>{P(),T()}),he(()=>{j()});let z=null;const T=()=>{z&&clearInterval(z),z=setInterval(()=>{!B.value&&!E.value&&_.value&&D()},3e4)},W=()=>{_.value=!_.value,_.value?(T(),r.success("自动刷新已开启")):(j(),r.info("自动刷新已关闭"))},j=()=>{z&&(clearInterval(z),z=null)},P=async()=>{E.value=!0;try{const t={page:b.value,per_page:h.value,...p},e=await N(t);S.value=e.data,w.value=e.total}catch(t){console.error("获取车位列表失败:",t),r.error(t.message||"获取车位列表失败")}finally{E.value=!1}},D=async()=>{B.value=!0;try{const t={page:b.value,per_page:h.value,...p},e=await N(t);S.value=e.data,w.value=e.total,r.success("车位状态已刷新")}catch(t){console.error("刷新车位状态失败:",t),r.error(t.message||"刷新车位状态失败")}finally{B.value=!1}},X=()=>{Object.keys(p).forEach(t=>{p[t]=""}),b.value=1,P()},Y=t=>{h.value=t,P()},ee=t=>{b.value=t,P()},$=()=>{A.value&&A.value.resetFields(),n.spot_number="",n.zone="",n.type="",n.status="空闲"},le=()=>{U.value="add",$(),C.value=!0},ae=t=>{U.value="edit",Object.keys(n).forEach(e=>{n[e]=t[e]}),n.id=t.id,C.value=!0},te=async()=>{A.value&&await A.value.validate(async t=>{if(t){const e=r({message:"正在提交...",duration:0,icon:"loading"});try{U.value==="add"?(await ge(n),r.success("添加成功")):(await O(n.id,n),r.success("更新成功")),C.value=!1,await D()}catch(u){console.error("提交表单失败:",u);let d="操作失败";u.response&&(u.response.data.message?d=u.response.data.message:u.response.status===400?d="请求参数错误":u.response.status===404&&(d="停车位不存在")),r.error(d)}finally{e.close()}}})},se=t=>{Ce.confirm("确定要删除该停车位吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _e(t.id),r.success("删除成功"),await D()}catch(e){console.error("删除失败:",e),r.error(e.message||"删除失败")}})},oe=()=>{r.info("导出功能开发中...")},ne=async t=>{try{await O(t.id,{is_active:t.is_active}),r.success("状态更新成功"),await D()}catch(e){console.error("状态更新失败:",e),r.error(e.message||"状态更新失败"),t.is_active=!t.is_active}},re=t=>({空闲:"success",已占用:"warning",已预约:"info",维修:"danger"})[t]||"info";return(t,e)=>{const u=i("el-option"),d=i("el-select"),m=i("el-button"),ue=i("el-tag"),ie=i("el-switch"),q=i("el-table-column"),de=i("el-table"),pe=i("el-pagination"),me=i("el-input"),M=i("el-form-item"),ce=i("el-form"),ve=i("el-dialog"),fe=ke("loading");return f(),y("div",ze,[e[24]||(e[24]=s("div",{class:"mb-6"},[s("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"停车场管理"),s("p",{class:"text-gray-500 mt-1"},"管理停车场车位信息，监控车位状态")],-1)),s("div",Se,[s("div",Ue,[s("div",Ae,[e[11]||(e[11]=s("label",{class:"text-sm font-medium text-gray-700"},"分区:",-1)),a(d,{modelValue:p.zone,"onUpdate:modelValue":e[0]||(e[0]=l=>p.zone=l),placeholder:"选择分区",clearable:"",size:"small",style:{width:"120px"}},{default:o(()=>[(f(),y(k,null,V(F,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),s("div",Pe,[e[12]||(e[12]=s("label",{class:"text-sm font-medium text-gray-700"},"类型:",-1)),a(d,{modelValue:p.type,"onUpdate:modelValue":e[1]||(e[1]=l=>p.type=l),placeholder:"选择类型",clearable:"",size:"small",style:{width:"120px"}},{default:o(()=>[(f(),y(k,null,V(R,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),s("div",De,[e[13]||(e[13]=s("label",{class:"text-sm font-medium text-gray-700"},"状态:",-1)),a(d,{modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=l=>p.status=l),placeholder:"选择状态",clearable:"",size:"small",style:{width:"120px"}},{default:o(()=>[(f(),y(k,null,V(I,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),s("div",Ee,[a(m,{type:"primary",size:"small",onClick:P},{default:o(()=>e[14]||(e[14]=[s("i",{class:"fa fa-search mr-1"},null,-1),g("搜索 ")])),_:1,__:[14]}),a(m,{size:"small",onClick:X},{default:o(()=>e[15]||(e[15]=[s("i",{class:"fa fa-refresh mr-1"},null,-1),g("重置 ")])),_:1,__:[15]})])])]),s("div",Be,[s("div",Me,[a(m,{type:"primary",onClick:le},{default:o(()=>e[16]||(e[16]=[s("i",{class:"fa fa-plus mr-1"},null,-1),g("添加停车位 ")])),_:1,__:[16]}),a(m,{onClick:oe},{default:o(()=>e[17]||(e[17]=[s("i",{class:"fa fa-download mr-1"},null,-1),g("导出数据 ")])),_:1,__:[17]}),a(m,{type:"success",onClick:D,loading:B.value},{default:o(()=>e[18]||(e[18]=[s("i",{class:"fa fa-refresh mr-1"},null,-1),g("刷新状态 ")])),_:1,__:[18]},8,["loading"]),a(m,{type:"info",onClick:W,size:"small"},{default:o(()=>[e[19]||(e[19]=s("i",{class:"fa fa-clock-o mr-1"},null,-1)),g(x(_.value?"关闭自动刷新":"开启自动刷新"),1)]),_:1,__:[19]})]),s("div",Fe,[s("div",Re," 共 "+x(w.value)+" 个车位 ",1),s("div",{class:H(["flex items-center gap-2 text-xs",_.value?"text-green-500":"text-gray-400"])},[s("div",{class:H(["w-2 h-2 rounded-full",_.value?"bg-green-500 animate-pulse":"bg-gray-400"])},null,2),s("span",null,x(_.value?"自动刷新已启用":"自动刷新已关闭"),1)],2)])]),s("div",Ie,[Ve((f(),J(de,{data:S.value,class:"table-row-hover"},{default:o(()=>[(f(!0),y(k,null,V(G.value,l=>(f(),J(q,{key:l,prop:l,label:Z[l]||l,"min-width":100},we({_:2},[l==="status"?{name:"default",fn:o(({row:c})=>[a(ue,{type:re(c.status),size:"small"},{default:o(()=>[g(x(c.status),1)]),_:2},1032,["type"])]),key:"0"}:l==="is_active"?{name:"default",fn:o(({row:c})=>[a(ie,{modelValue:c.is_active,"onUpdate:modelValue":L=>c.is_active=L,onChange:L=>ne(c),size:"small"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),key:"1"}:{name:"default",fn:o(({row:c})=>[g(x(c[l]),1)]),key:"2"}]),1032,["prop","label"]))),128)),a(q,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[s("div",Te,[a(m,{size:"small",onClick:c=>ae(l)},{default:o(()=>e[20]||(e[20]=[s("i",{class:"fa fa-edit"},null,-1)])),_:2,__:[20]},1032,["onClick"]),a(m,{size:"small",type:"danger",onClick:c=>se(l)},{default:o(()=>e[21]||(e[21]=[s("i",{class:"fa fa-trash"},null,-1)])),_:2,__:[21]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[fe,E.value]]),s("div",je,[s("p",$e,"显示 "+x((b.value-1)*h.value+1)+" 至 "+x(Math.min(b.value*h.value,w.value))+" 条，共 "+x(w.value)+" 条",1),a(pe,{"current-page":b.value,"onUpdate:currentPage":e[3]||(e[3]=l=>b.value=l),"page-size":h.value,"onUpdate:pageSize":e[4]||(e[4]=l=>h.value=l),"page-sizes":[10,20,50,100],layout:"sizes, prev, pager, next",total:w.value,onSizeChange:Y,onCurrentChange:ee,size:"small"},null,8,["current-page","page-size","total"])])]),a(ve,{title:U.value==="add"?"添加停车位":"编辑停车位",modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=l=>C.value=l),width:"500px",onClosed:$},{footer:o(()=>[s("span",qe,[a(m,{class:"pretty-btn",onClick:e[9]||(e[9]=l=>C.value=!1)},{default:o(()=>e[22]||(e[22]=[g("取消")])),_:1,__:[22]}),a(m,{class:"pretty-btn",type:"primary",onClick:te},{default:o(()=>e[23]||(e[23]=[g("确定")])),_:1,__:[23]})])]),default:o(()=>[a(ce,{ref_key:"formRef",ref:A,model:n,rules:Q,"label-width":"100px"},{default:o(()=>[a(M,{label:"车位号",prop:"spot_number"},{default:o(()=>[a(me,{modelValue:n.spot_number,"onUpdate:modelValue":e[5]||(e[5]=l=>n.spot_number=l),disabled:U.value==="edit",placeholder:"请输入车位号，如A001"},null,8,["modelValue","disabled"])]),_:1}),a(M,{label:"分区",prop:"zone"},{default:o(()=>[a(d,{modelValue:n.zone,"onUpdate:modelValue":e[6]||(e[6]=l=>n.zone=l),placeholder:"选择分区"},{default:o(()=>[(f(),y(k,null,V(F,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(M,{label:"类型",prop:"type"},{default:o(()=>[a(d,{modelValue:n.type,"onUpdate:modelValue":e[7]||(e[7]=l=>n.type=l),placeholder:"选择类型"},{default:o(()=>[(f(),y(k,null,V(R,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(M,{label:"状态",prop:"status"},{default:o(()=>[a(d,{modelValue:n.status,"onUpdate:modelValue":e[8]||(e[8]=l=>n.status=l),placeholder:"选择状态"},{default:o(()=>[(f(),y(k,null,V(I,l=>a(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}},Je=be(Le,[["__scopeId","data-v-3b32fd70"]]);export{Je as default};
