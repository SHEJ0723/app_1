import{a as _}from"./index-d5848531.js";import{_ as K,r as u,H as y,s as L,b as V,o as p,c as b,d as e,l as O,f as c,j as U,e as n,t as o,F as T,J as q,E as d,h as m,C as $}from"./index-06309a7e.js";const G={class:"fade-in"},P={class:"mb-6"},Q={class:"flex justify-between items-center"},W={class:"flex gap-3"},X={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},Y={class:"stat-card"},Z={class:"flex justify-between items-start"},ee={class:"text-2xl font-semibold mt-1"},te={class:"stat-card"},se={class:"flex justify-between items-start"},le={class:"text-2xl font-semibold mt-1"},ae={class:"stat-card"},oe={class:"flex justify-between items-start"},ne={class:"text-2xl font-semibold mt-1"},de={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 mb-6"},re={class:"flex justify-between items-center"},ie={class:"flex items-center gap-4"},ce={class:"text-sm text-gray-500"},ue={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-6"},me={class:"flex justify-between items-center mb-6"},fe={class:"overflow-x-auto"},_e={class:"w-full"},pe={class:"border-b border-gray-100"},ve={class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},xe={class:"py-3 px-4"},ge={class:"py-3 px-4"},ye={class:"py-3 px-4"},be={class:"py-3 px-4 text-sm text-gray-600"},he={class:"py-3 px-4"},we={key:0,class:"text-center py-12"},ke={class:"text-gray-500"},Ce={class:"message-content"},Ve={class:"message-header"},je={class:"message-meta"},Me={class:"message-time"},ze={class:"message-body"},Ue={__name:"Messages",setup($e){const a=u([]),h=u(!1),j=u(""),v=u({}),x=u(!1),r=u([]),g=u(!1),f=y(()=>x.value?a.value.filter(s=>!s.is_read):a.value),M=y(()=>a.value.filter(s=>!s.is_read).length),A=y(()=>a.value.filter(s=>s.is_read).length),B=y(()=>{const s=r.value.length;return s>0&&s<f.value.length}),z=s=>s?"bg-success/10 text-success":"bg-danger/10 text-danger",w=async()=>{try{const s=await _.get("/api/messages");a.value=(s.data||[]).map(t=>({...t,selected:!1}))}catch{d.error("获取消息失败")}},E=async s=>{try{await _.delete(`/api/messages/${s}`),d.success("删除成功"),w()}catch{d.error("删除失败")}},S=async s=>{if(j.value=s.content,v.value=s,h.value=!0,!s.is_read)try{await _.put(`/api/messages/${s.id}/read`),s.is_read=!0}catch(t){console.error("标记已读失败:",t)}},D=()=>{r.value=a.value.filter(s=>s.selected).map(s=>s.id),R()},N=s=>{f.value.forEach(t=>{t.selected=s}),r.value=s?f.value.map(t=>t.id):[]},R=()=>{const s=r.value.length,t=f.value.length;g.value=s===t&&t>0},F=async()=>{try{for(const s of r.value){const t=a.value.find(i=>i.id===s);t&&!t.is_read&&(await _.put(`/api/messages/${s}/read`),t.is_read=!0)}d.success("批量标记为已读成功"),r.value=[],a.value.forEach(s=>s.selected=!1),g.value=!1}catch{d.error("批量标记失败")}},I=async()=>{try{for(const s of a.value)s.is_read||(await _.put(`/api/messages/${s.id}/read`),s.is_read=!0);d.success("全部标记为已读成功")}catch{d.error("标记失败")}},H=async()=>{try{await _.delete("/api/messages/clear-all"),a.value=[],d.success("清空成功")}catch{d.error("清空失败")}};return L(w),(s,t)=>{const i=V("el-button"),k=V("el-checkbox"),J=V("el-dialog");return p(),b("div",G,[e("div",P,[e("div",Q,[t[5]||(t[5]=e("div",null,[e("h2",{class:"text-[clamp(1.25rem,3vw,1.75rem)] font-semibold"},"消息中心"),e("p",{class:"text-gray-500 mt-1"},"查看和管理您的系统消息")],-1)),e("div",W,[M.value>0?(p(),O(i,{key:0,type:"primary",size:"small",onClick:I},{default:c(()=>t[3]||(t[3]=[e("i",{class:"fa fa-check-double mr-1"},null,-1),m(" 全部标为已读 ")])),_:1,__:[3]})):U("",!0),n(i,{type:"danger",size:"small",onClick:H},{default:c(()=>t[4]||(t[4]=[e("i",{class:"fa fa-trash mr-1"},null,-1),m(" 清空 ")])),_:1,__:[4]})])])]),e("div",X,[e("div",Y,[e("div",Z,[e("div",null,[t[6]||(t[6]=e("p",{class:"text-gray-500 text-sm"},"总消息",-1)),e("h3",ee,o(a.value.length),1)]),t[7]||(t[7]=e("div",{class:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary"},[e("i",{class:"fa fa-envelope"})],-1))])]),e("div",te,[e("div",se,[e("div",null,[t[8]||(t[8]=e("p",{class:"text-gray-500 text-sm"},"未读消息",-1)),e("h3",le,o(M.value),1)]),t[9]||(t[9]=e("div",{class:"w-10 h-10 rounded-full bg-danger/10 flex items-center justify-center text-danger"},[e("i",{class:"fa fa-bell"})],-1))])]),e("div",ae,[e("div",oe,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-gray-500 text-sm"},"已读消息",-1)),e("h3",ne,o(A.value),1)]),t[11]||(t[11]=e("div",{class:"w-10 h-10 rounded-full bg-success/10 flex items-center justify-center text-success"},[e("i",{class:"fa fa-check-circle"})],-1))])])]),e("div",de,[e("div",re,[e("div",ie,[n(k,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l),class:"filter-checkbox"},{default:c(()=>t[12]||(t[12]=[m(" 只看未读消息 ")])),_:1,__:[12]},8,["modelValue"]),n(i,{type:"primary",size:"small",disabled:!r.value.length,onClick:F,class:"batch-btn"},{default:c(()=>t[13]||(t[13]=[e("i",{class:"fa fa-check mr-1"},null,-1),m(" 批量标为已读 ")])),_:1,__:[13]},8,["disabled"])]),e("div",ce," 已选择 "+o(r.value.length)+" 条消息 ",1)])]),e("div",ue,[e("div",me,[t[15]||(t[15]=e("h3",{class:"font-medium text-lg"},"消息列表",-1)),n(i,{type:"primary",size:"small",onClick:w},{default:c(()=>t[14]||(t[14]=[e("i",{class:"fa fa-refresh mr-1"},null,-1),m(" 刷新 ")])),_:1,__:[14]})]),e("div",fe,[e("table",_e,[e("thead",null,[e("tr",pe,[e("th",ve,[n(k,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),onChange:N,indeterminate:B.value},null,8,["modelValue","indeterminate"])]),t[16]||(t[16]=e("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"状态",-1)),t[17]||(t[17]=e("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"内容",-1)),t[18]||(t[18]=e("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"时间",-1)),t[19]||(t[19]=e("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500"},"操作",-1))])]),e("tbody",null,[(p(!0),b(T,null,q(f.value,l=>(p(),b("tr",{key:l.id,class:"border-b border-gray-50 hover:bg-gray-50"},[e("td",xe,[n(k,{modelValue:l.selected,"onUpdate:modelValue":C=>l.selected=C,onChange:D},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ge,[e("span",{class:$([z(l.is_read),"px-2 py-1 rounded-full text-xs"])},o(l.is_read?"已读":"未读"),3)]),e("td",ye,[n(i,{type:"primary",link:"",onClick:C=>S(l),class:"view-btn"},{default:c(()=>t[20]||(t[20]=[e("i",{class:"fa fa-eye mr-1"},null,-1),m(" 查看内容 ")])),_:2,__:[20]},1032,["onClick"])]),e("td",be,o(l.created_at),1),e("td",he,[n(i,{type:"danger",size:"small",onClick:C=>E(l.id),class:"delete-btn"},{default:c(()=>t[21]||(t[21]=[e("i",{class:"fa fa-trash mr-1"},null,-1),m(" 删除 ")])),_:2,__:[21]},1032,["onClick"])])]))),128))])])]),f.value.length===0?(p(),b("div",we,[t[22]||(t[22]=e("i",{class:"fa fa-inbox text-4xl text-gray-300 mb-4"},null,-1)),e("p",ke,o(x.value?"暂无未读消息":"暂无消息"),1)])):U("",!0)]),n(J,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=l=>h.value=l),title:"消息详情",width:"600px",class:"message-dialog"},{default:c(()=>[e("div",Ce,[e("div",Ve,[e("div",je,[e("span",Me,o(v.value.created_at),1),e("span",{class:$([z(v.value.is_read),"message-status"])},o(v.value.is_read?"已读":"未读"),3)])]),e("div",ze,o(j.value),1)])]),_:1},8,["modelValue"])])}}},Ee=K(Ue,[["__scopeId","data-v-88bf4e0c"]]);export{Ee as default};
